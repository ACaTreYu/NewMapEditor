---
phase: 10-map-settings-dialog
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - src/components/MapSettingsDialog/SettingInput.tsx
  - src/components/MapSettingsDialog/MapSettingsDialog.tsx
  - src/components/MapSettingsDialog/MapSettingsDialog.css
autonomous: true

must_haves:
  truths:
    - "Each numeric setting displays as synced slider + text input"
    - "Min/max labels shown at slider ends"
    - "Each setting has a reset-to-default button"
    - "Map tab shows name and description text fields"
    - "Invalid text input clamps to nearest valid value"
    - "Tabs display their category's settings from GAME_SETTINGS"
  artifacts:
    - path: "src/components/MapSettingsDialog/SettingInput.tsx"
      provides: "Reusable slider+input component with reset button"
      exports: ["SettingInput"]
      min_lines: 50
    - path: "src/components/MapSettingsDialog/MapSettingsDialog.tsx"
      provides: "Dialog with populated tab content"
      contains: "SettingInput"
      min_lines: 150
  key_links:
    - from: "src/components/MapSettingsDialog/MapSettingsDialog.tsx"
      to: "src/components/MapSettingsDialog/SettingInput.tsx"
      via: "import and render"
      pattern: "import.*SettingInput"
    - from: "src/components/MapSettingsDialog/SettingInput.tsx"
      to: "slider onChange"
      via: "setValue synchronization"
      pattern: "onChange.*setValue"
---

<objective>
Implement the actual tab content with SettingInput components for all game settings, including synchronized slider/input controls and per-setting reset buttons.

Purpose: Complete the dialog's functional content - users can view and edit all 40+ game settings organized by category tabs.
Output: SettingInput reusable component, populated tabs with all settings, Map tab with name/description fields.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@E:\NewMapEditor\.planning\PROJECT.md
@E:\NewMapEditor\.planning\phases\10-map-settings-dialog\10-CONTEXT.md
@E:\NewMapEditor\.planning\phases\10-map-settings-dialog\10-RESEARCH.md
@E:\NewMapEditor\src\components\MapSettingsPanel\MapSettingsPanel.tsx
@E:\NewMapEditor\src\core\map\types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SettingInput reusable component</name>
  <files>src/components/MapSettingsDialog/SettingInput.tsx</files>
  <action>
Create reusable SettingInput component for numeric settings with synchronized slider + text input:

```tsx
import React from 'react';
import { GameSetting } from '@core/map';

interface SettingInputProps {
  setting: GameSetting;
  value: number;
  onChange: (value: number) => void;
  onReset: () => void;
}

export const SettingInput: React.FC<SettingInputProps> = ({
  setting,
  value,
  onChange,
  onReset
}) => {
  const { label, min, max, default: defaultValue } = setting;

  const handleSliderChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    onChange(parseInt(e.target.value, 10));
  };

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const val = parseInt(e.target.value, 10);
    if (!isNaN(val)) {
      // Clamp to valid range
      onChange(Math.max(min, Math.min(max, val)));
    }
  };

  const isDefault = value === defaultValue;

  return (
    <div className="setting-input-row">
      <label className="setting-input-label">{label}</label>
      <div className="setting-input-controls">
        <span className="range-label min">{min}</span>
        <input
          type="range"
          min={min}
          max={max}
          step={1}
          value={value}
          onChange={handleSliderChange}
          className="setting-slider"
        />
        <span className="range-label max">{max}</span>
        <input
          type="number"
          min={min}
          max={max}
          value={value}
          onChange={handleInputChange}
          className="setting-number-input"
        />
        <button
          type="button"
          className="reset-button"
          onClick={onReset}
          disabled={isDefault}
          title={`Reset to default (${defaultValue})`}
        >
          {/* Unicode reset/undo symbol */}
          &#8634;
        </button>
      </div>
    </div>
  );
};
```

Key features:
- Single value prop controls both slider and input (synced)
- Clamping on text input via Math.max/min (no error messages per CONTEXT.md)
- Reset button disabled when value equals default
- Reset button title shows default value
- Uses step={1} for 1-granularity per requirements
  </action>
  <verify>`npm run typecheck` passes</verify>
  <done>SettingInput component exists with slider + number input + reset button, all synchronized via single value prop.</done>
</task>

<task type="auto">
  <name>Task 2: Populate dialog tabs with settings content</name>
  <files>src/components/MapSettingsDialog/MapSettingsDialog.tsx, src/components/MapSettingsDialog/MapSettingsDialog.css</files>
  <action>
Update MapSettingsDialog to render actual settings in each tab:

**MapSettingsDialog.tsx changes:**

1. Add local state for settings values:
```tsx
const [localSettings, setLocalSettings] = useState<Record<string, number>>(() => getDefaultSettings());
const [mapName, setMapName] = useState('');
const [mapDescription, setMapDescription] = useState('');
```

2. Create helper functions:
```tsx
const updateSetting = (key: string, value: number) => {
  setLocalSettings(prev => ({ ...prev, [key]: value }));
};

const resetSetting = (key: string, defaultValue: number) => {
  setLocalSettings(prev => ({ ...prev, [key]: defaultValue }));
};
```

3. Update tab content rendering:

For "Map" tab (index 0):
```tsx
<div role="tabpanel" hidden={activeTab !== 0} className="tab-panel">
  <div className="setting-group">
    <label className="setting-label">Map Name</label>
    <input
      type="text"
      value={mapName}
      onChange={(e) => setMapName(e.target.value)}
      className="text-input"
      maxLength={32}
    />
  </div>
  <div className="setting-group">
    <label className="setting-label">Description</label>
    <textarea
      value={mapDescription}
      onChange={(e) => setMapDescription(e.target.value)}
      className="text-area"
      rows={3}
      maxLength={256}
    />
  </div>
</div>
```

For other tabs (index > 0), render settings by category:
```tsx
{SETTING_CATEGORIES.slice(1).map((category, i) => {
  const tabIndex = i + 1;
  const categorySettings = getSettingsByCategory(category);
  return (
    <div
      key={category}
      role="tabpanel"
      hidden={activeTab !== tabIndex}
      className="tab-panel"
    >
      {categorySettings.map(setting => (
        <SettingInput
          key={setting.key}
          setting={setting}
          value={localSettings[setting.key] ?? setting.default}
          onChange={(val) => updateSetting(setting.key, val)}
          onReset={() => resetSetting(setting.key, setting.default)}
        />
      ))}
    </div>
  );
})}
```

4. Import SettingInput and helpers:
```tsx
import { SETTING_CATEGORIES, GAME_SETTINGS, getSettingsByCategory, getDefaultSettings } from '@core/map';
import { SettingInput } from './SettingInput';
```

**MapSettingsDialog.css additions:**

1. Setting input row layout:
```css
.setting-input-row {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
  gap: 8px;
}

.setting-input-label {
  flex: 0 0 120px;
  font-size: 11px;
  color: var(--text-primary);
}

.setting-input-controls {
  display: flex;
  align-items: center;
  gap: 6px;
  flex: 1;
}
```

2. Range labels (min/max at slider ends):
```css
.range-label {
  font-size: 10px;
  color: var(--text-tertiary);
  min-width: 45px;
  text-align: center;
}

.range-label.min {
  text-align: right;
}

.range-label.max {
  text-align: left;
}
```

3. Slider styling (reuse existing patterns):
```css
.setting-slider {
  flex: 1;
  min-width: 100px;
  height: 4px;
  -webkit-appearance: none;
  background: var(--slider-track);
  border-radius: 2px;
  cursor: pointer;
}

.setting-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  background: var(--slider-thumb);
  border-radius: 50%;
  cursor: grab;
}

.setting-slider::-webkit-slider-thumb:active {
  cursor: grabbing;
  background: var(--slider-thumb-active);
}
```

4. Number input:
```css
.setting-number-input {
  width: 70px;
  padding: 2px 4px;
  font-size: 11px;
  color: var(--text-primary);
  background: var(--input-bg);
  border: 1px solid var(--input-border);
  text-align: center;
}

.setting-number-input:focus {
  outline: none;
  border-color: var(--input-focus);
}
```

5. Reset button:
```css
.reset-button {
  width: 20px;
  height: 20px;
  padding: 0;
  font-size: 12px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-default);
  color: var(--text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.reset-button:hover:not(:disabled) {
  background: var(--bg-hover);
  color: var(--text-primary);
}

.reset-button:disabled {
  opacity: 0.4;
  cursor: default;
}
```

6. Text inputs for Map tab:
```css
.text-input, .text-area {
  width: 100%;
  padding: 4px 6px;
  font-size: 11px;
  color: var(--text-primary);
  background: var(--input-bg);
  border: 1px solid var(--input-border);
  font-family: inherit;
}

.text-area {
  resize: vertical;
  min-height: 60px;
}

.setting-group {
  margin-bottom: 12px;
}

.setting-label {
  display: block;
  font-size: 11px;
  color: var(--text-primary);
  margin-bottom: 4px;
}
```

7. Tab panel content area:
```css
.tab-panel {
  padding: 12px;
  min-height: 300px;
  max-height: 400px;
  overflow-y: auto;
}
```
  </action>
  <verify>
1. `npm run typecheck` passes
2. Run `npm run electron:dev`, manually test:
   - Open dialog (will need temporary button or toolbar integration in Plan 03)
   - Click through all 10 tabs
   - Verify each tab shows its category's settings
   - Verify slider/input sync (move slider, number updates; type number, slider updates)
   - Verify reset button is disabled when value equals default
   - Verify reset button restores default value when clicked
  </verify>
  <done>All 10 tabs render their settings using SettingInput. Map tab shows name/description text fields. Slider and input are synchronized. Reset buttons work for each setting.</done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes
2. SettingInput component accepts setting/value/onChange/onReset props
3. Slider and text input display same value
4. Moving slider updates text input immediately
5. Typing in text input updates slider immediately
6. Invalid input (out of range) clamps to nearest valid value
7. Reset button shows default value in tooltip
8. Reset button disabled when value equals default
9. Map tab shows name and description text fields
10. Each category tab shows settings from GAME_SETTINGS with matching category
</verification>

<success_criteria>
- SettingInput component is reusable for all numeric settings
- All 10 tabs display their respective settings
- Slider/input synchronization works correctly
- Per-setting reset buttons work correctly
- Map tab displays name and description fields
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-map-settings-dialog/10-02-SUMMARY.md`
</output>
