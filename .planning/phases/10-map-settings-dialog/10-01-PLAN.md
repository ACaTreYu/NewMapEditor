---
phase: 10-map-settings-dialog
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/core/map/GameSettings.ts
  - src/components/MapSettingsDialog/MapSettingsDialog.tsx
  - src/components/MapSettingsDialog/MapSettingsDialog.css
autonomous: true

must_haves:
  truths:
    - "Settings type definitions exist with key, label, min, max, default, category"
    - "All 40+ settings from AC_Setting_Info_25.txt are defined as constants"
    - "Dialog opens via showModal() when button clicked"
    - "Dialog has Win95/98 raised border styling"
    - "Dialog has property sheet tab bar structure"
  artifacts:
    - path: "src/core/map/GameSettings.ts"
      provides: "GameSetting interface and GAME_SETTINGS constant array"
      exports: ["GameSetting", "GAME_SETTINGS", "SETTING_CATEGORIES"]
      min_lines: 150
    - path: "src/components/MapSettingsDialog/MapSettingsDialog.tsx"
      provides: "Dialog component shell with tab structure"
      exports: ["MapSettingsDialog"]
      min_lines: 80
    - path: "src/components/MapSettingsDialog/MapSettingsDialog.css"
      provides: "Win95 property sheet dialog styling"
      contains: "map-settings-dialog"
      min_lines: 100
  key_links:
    - from: "src/components/MapSettingsDialog/MapSettingsDialog.tsx"
      to: "src/core/map/GameSettings.ts"
      via: "import { GAME_SETTINGS, SETTING_CATEGORIES }"
      pattern: "import.*GameSettings"
---

<objective>
Create the Map Settings dialog foundation including all game setting type definitions from AC_Setting_Info_25.txt and the Win95-styled dialog shell with tabbed structure.

Purpose: Establish the data layer (all 40+ settings with ranges and defaults) and visual foundation (HTML5 dialog with Win95 property sheet styling) for the settings dialog.
Output: GameSettings.ts with complete setting definitions, dialog component shell with tabs, Win95 CSS styling.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@E:\NewMapEditor\.planning\PROJECT.md
@E:\NewMapEditor\.planning\ROADMAP.md
@E:\NewMapEditor\.planning\STATE.md
@E:\NewMapEditor\.planning\phases\10-map-settings-dialog\10-CONTEXT.md
@E:\NewMapEditor\.planning\phases\10-map-settings-dialog\10-RESEARCH.md
@E:\NewMapEditor\AC_Setting_Info_25.txt
@E:\NewMapEditor\src\App.css
@E:\NewMapEditor\src\core\map\types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GameSettings type definitions and constants</name>
  <files>src/core/map/GameSettings.ts</files>
  <action>
Create new file with:

1. GameSetting interface:
```typescript
export interface GameSetting {
  key: string;           // Setting key (e.g., 'LaserDamage')
  label: string;         // Display label (e.g., 'Laser Damage')
  min: number;           // Minimum value
  max: number;           // Maximum value
  default: number;       // Default value
  category: string;      // Category for tab grouping
  description?: string;  // Optional tooltip text
}
```

2. SETTING_CATEGORIES constant array defining tab order:
```typescript
export const SETTING_CATEGORIES = [
  'Map',        // name, description (these are header fields, not game settings)
  'General',    // ShipSpeed, HealthBonus, HealthDecay, RepairRate, TurretHealth
  'Laser',      // LaserDamage, LaserEnergy, LaserTTL, LaserSpeed
  'Missile',    // MissileDamage, MissileEnergy, MissileTTL, MissileRecharge, MissileSpeed
  'Bouncy',     // BouncyDamage, BouncyEnergy, BouncyTTL, BouncyRecharge, BouncySpeed
  'Grenade',    // NadeDamage, NadeEnergy, ShrapTTL, ShrapSpeed, NadeRecharge, NadeSpeed
  'Game',       // HoldingTime, ElectionTime, SwitchWin, DominationWin
  'DHT',        // DHT_players, DHT_time, DHT_deaths, DHT_score, DHT_turrets, DHT_minimum, DHT_maximum
  'Flagger',    // F-prefixed variants
  'Toggles',    // Boolean settings (min 0, max 1)
] as const;
```

3. GAME_SETTINGS array with ALL settings from AC_Setting_Info_25.txt:

Movement:
- ShipSpeed: 0-200, default 100, General

Laser:
- LaserDamage: 0-225, default 27
- LaserEnergy: 0-57, default 12
- LaserTTL: 0-10000, default 480
- LaserSpeed: 0-100, default 50

Missile:
- MissileDamage: 0-225, default 102
- MissileEnergy: 0-57, default 37
- MissileTTL: 0-10000, default 480
- MissileRecharge: 0-100000, default 945
- MissileSpeed: 0-100, default 50

Bouncy:
- BouncyDamage: 0-225, default 48
- BouncyEnergy: 0-57, default 12
- BouncyTTL: 0-10000, default 970
- BouncyRecharge: 0-100000, default 765
- BouncySpeed: 0-100, default 50

Grenade:
- NadeDamage: 0-225, default 21
- NadeEnergy: 0-57, default 19
- ShrapTTL: 0-10000, default 128
- ShrapSpeed: 0-100, default 50
- NadeRecharge: 0-100000, default 1950
- NadeSpeed: 0-100, default 50

General:
- HealthBonus: 0-224, default 60
- HealthDecay: 0-224, default 0
- RepairRate: 0-244, default 2
- TurretHealth: 0-224, default 224

Game:
- ElectionTime: 0-255, default 50
- HoldingTime: 0-255, default 0
- SwitchWin: 0-9999, default 0
- DominationWin: 0-9999999, default 9999999

DHT (all -999999 to 999999, default 0 except noted):
- DHT_players
- DHT_time
- DHT_deaths
- DHT_score
- DHT_turrets
- DHT_minimum: 0-255, default 1
- DHT_maximum: 0-255, default 255

Toggles (all 0-1, default 0):
- DisableSwitchSound
- InvisibleMap
- FogOfWar
- FlagInPlay
- Widescreen

Flagger variants (F-prefixed, same ranges as originals):
- FShipSpeed, FLaserDamage, FLaserEnergy, FMissileDamage, FMissileEnergy
- FBouncyDamage, FBouncyEnergy, FNadeDamage, FNadeEnergy
- FHealthBonus, FHealthDecay, FRepairRate

4. Helper function to get settings by category:
```typescript
export function getSettingsByCategory(category: string): GameSetting[] {
  return GAME_SETTINGS.filter(s => s.category === category);
}
```

5. Helper to get default values as Record:
```typescript
export function getDefaultSettings(): Record<string, number> {
  return GAME_SETTINGS.reduce((acc, s) => {
    acc[s.key] = s.default;
    return acc;
  }, {} as Record<string, number>);
}
```

Export the index.ts to expose these: Update src/core/map/index.ts to export from GameSettings.ts
  </action>
  <verify>TypeScript compiles without errors: `npm run typecheck`</verify>
  <done>GameSettings.ts exists with 40+ settings defined, each with key/label/min/max/default/category. SETTING_CATEGORIES array defines 10 tab categories.</done>
</task>

<task type="auto">
  <name>Task 2: Create MapSettingsDialog component shell with Win95 styling</name>
  <files>src/components/MapSettingsDialog/MapSettingsDialog.tsx, src/components/MapSettingsDialog/MapSettingsDialog.css</files>
  <action>
Create MapSettingsDialog component folder and files:

**MapSettingsDialog.tsx:**
1. Use HTML5 `<dialog>` element with useRef for showModal()/close() control
2. Export openDialog function that parent can call
3. Tab state with useState (activeTab index)
4. Render tab bar using SETTING_CATEGORIES
5. Placeholder tabpanel divs (content filled in Plan 02)
6. Apply/Close button row at bottom

Structure:
```tsx
import { useRef, useState, forwardRef, useImperativeHandle } from 'react';
import { SETTING_CATEGORIES } from '@core/map';
import './MapSettingsDialog.css';

export interface MapSettingsDialogHandle {
  open: () => void;
}

export const MapSettingsDialog = forwardRef<MapSettingsDialogHandle>((_, ref) => {
  const dialogRef = useRef<HTMLDialogElement>(null);
  const [activeTab, setActiveTab] = useState(0);

  useImperativeHandle(ref, () => ({
    open: () => dialogRef.current?.showModal()
  }));

  const handleClose = () => {
    dialogRef.current?.close();
  };

  return (
    <dialog ref={dialogRef} className="map-settings-dialog">
      <div className="dialog-title-bar">
        Map Settings
      </div>
      <div className="dialog-content">
        <menu role="tablist" className="dialog-tabs">
          {SETTING_CATEGORIES.map((cat, i) => (
            <li
              key={cat}
              role="tab"
              aria-selected={activeTab === i}
              onClick={() => setActiveTab(i)}
            >
              {cat}
            </li>
          ))}
        </menu>

        <div className="tab-content">
          {SETTING_CATEGORIES.map((cat, i) => (
            <div
              key={cat}
              role="tabpanel"
              hidden={activeTab !== i}
              className="tab-panel"
            >
              {/* Content filled in Plan 02 */}
              <p>Settings for {cat} tab</p>
            </div>
          ))}
        </div>

        <div className="dialog-buttons">
          <button className="win95-button" onClick={handleClose}>
            Close
          </button>
        </div>
      </div>
    </dialog>
  );
});

MapSettingsDialog.displayName = 'MapSettingsDialog';
```

**MapSettingsDialog.css:**
Win95 property sheet styling following patterns from RESEARCH.md and existing App.css:

1. Dialog base styling:
   - border: none
   - background: var(--bg-primary)
   - padding: 0
   - Win95 raised border using box-shadow (inset -1px -1px #0a0a0a, inset 1px 1px #dfdfdf, etc.)
   - max-width: 600px, max-height: 80vh
   - ::backdrop with semi-transparent overlay

2. Title bar:
   - Same gradient as .panel-title-bar (#000080 to #1084d0)
   - White text, bold
   - 2px 8px padding

3. Tab bar (menu[role="tablist"]):
   - Horizontal flex, no list-style
   - Border-bottom for tab rail
   - Gap between tabs

4. Individual tabs (li[role="tab"]):
   - Background: var(--bg-secondary)
   - Border: 1px solid var(--border-default), no bottom border
   - Border-radius: 4px 4px 0 0
   - Cursor: pointer
   - Hover state: var(--bg-hover)

5. Selected tab (aria-selected="true"):
   - Background: var(--bg-primary)
   - Raised effect: border-top 2px #ffffff, border-left 2px #ffffff, border-right 2px #808080
   - margin-bottom: -2px (overlap rail)
   - z-index: 1

6. Tab content area:
   - Padding for settings content
   - Min-height for consistent dialog size

7. Win95 button styling:
   - background: #c0c0c0
   - box-shadow for 3D raised effect
   - :active state with inverted shadows

8. Button row:
   - flex, justify-end, gap 8px
   - Border-top for separation

Create index.ts in MapSettingsDialog folder to export component.
  </action>
  <verify>Run `npm run typecheck` and verify no errors. Run `npm run electron:dev` and verify no crash on load.</verify>
  <done>MapSettingsDialog component exists with HTML5 dialog, Win95 title bar, 10 tabs in property sheet style, Close button. Dialog can be opened programmatically via ref.open().</done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes
2. GameSettings.ts contains 40+ entries in GAME_SETTINGS array
3. Each entry has key, label, min, max, default, category
4. SETTING_CATEGORIES defines exactly 10 categories
5. MapSettingsDialog.tsx compiles without errors
6. MapSettingsDialog.css uses Win95 box-shadow patterns
7. Dialog uses HTML5 `<dialog>` element with useRef pattern
</verification>

<success_criteria>
- GameSettings.ts exists with complete setting definitions from AC_Setting_Info_25.txt
- MapSettingsDialog component renders with Win95 property sheet tabs
- Dialog opens via showModal() when ref.open() called
- Tab switching works (activeTab state updates on click)
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-map-settings-dialog/10-01-SUMMARY.md`
</output>
