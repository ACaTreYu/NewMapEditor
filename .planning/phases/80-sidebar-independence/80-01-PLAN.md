---
phase: 80-sidebar-independence
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/App.tsx
  - src/App.css
  - src/components/ToolBar/ToolBar.tsx
autonomous: true

must_haves:
  truths:
    - "Minimap is always visible in top-right corner of canvas area regardless of sidebar state"
    - "Clicking toolbar toggle button collapses animations panel and game object tool panel"
    - "When animations panel is collapsed, canvas expands horizontally to fill the freed space"
    - "When animations panel is expanded, minimap on top with animations below (current stacked appearance)"
    - "Game object tool panel visibility follows animations panel collapse state"
  artifacts:
    - path: "src/App.tsx"
      provides: "Layout restructuring with minimap overlay and sidebar collapse via toolbar"
      contains: "minimap-overlay"
    - path: "src/App.css"
      provides: "CSS for minimap overlay positioning and updated sidebar styles"
      contains: "minimap-overlay"
    - path: "src/components/ToolBar/ToolBar.tsx"
      provides: "Sidebar toggle button in toolbar"
      contains: "LuPanelRightOpen"
  key_links:
    - from: "src/App.tsx"
      to: "src/components/ToolBar/ToolBar.tsx"
      via: "rightSidebarCollapsed prop and onToggleSidebar callback"
      pattern: "rightSidebarCollapsed.*onToggleSidebar"
    - from: "src/App.tsx"
      to: "src/App.css"
      via: "minimap-overlay className"
      pattern: "minimap-overlay"
    - from: "src/App.tsx"
      to: "src/components/Minimap/Minimap.tsx"
      via: "Minimap rendered inside minimap-overlay div"
      pattern: "minimap-overlay.*Minimap"
---

<objective>
Decouple minimap from animations panel so minimap stays visible in a fixed top-right corner overlay while animations panel collapses/expands independently via a toolbar toggle button.

Purpose: Maximizes canvas editing area when animations panel is not needed, without losing minimap navigation.
Output: Restructured App layout with independent minimap overlay, collapsible animations sidebar, and toolbar toggle.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/App.tsx
@src/App.css
@src/components/ToolBar/ToolBar.tsx
@src/components/Minimap/Minimap.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure layout — minimap overlay + collapsible sidebar</name>
  <files>src/App.tsx, src/App.css</files>
  <action>
  **App.tsx layout restructuring:**

  1. Wrap the existing `PanelGroup` (lines 327-349) in a new `<div className="canvas-area-wrapper">`. This wrapper needs `position: relative` so the minimap can overlay it.

  2. Inside `canvas-area-wrapper`, AFTER the `</PanelGroup>` closing tag, add the minimap overlay:
     ```tsx
     <div className="minimap-overlay">
       <Minimap tilesetImage={tilesetImage} farplaneImage={farplaneImage} />
     </div>
     ```

  3. Remove the `<Minimap>` component from the `right-sidebar-container` div (currently at line 360).

  4. Remove the old `sidebar-collapse-toggle` button (lines 352-356). The collapse toggle will move to the toolbar in Task 2.

  5. Update the `right-sidebar-container` div (line 359):
     - Change from always-rendered with conditional children to fully conditionally rendered:
     ```tsx
     {!rightSidebarCollapsed && (
       <div className="right-sidebar-container" onMouseDown={() => setFocusedPanel('animations')} tabIndex={-1}>
         <div className="animation-panel-container">
           <div className={`panel-title-bar ${focusedPanel === 'animations' ? 'active' : 'inactive'}`}>Animations</div>
           <AnimationPanel tilesetImage={tilesetImage} />
         </div>
         <GameObjectToolPanel />
       </div>
     )}
     ```
     - No `sidebar-collapsed` class needed — the entire container is unmounted when collapsed.

  6. Pass two new props to `<ToolBar>`:
     ```tsx
     <ToolBar
       tilesetImage={tilesetImage}
       onNewMap={handleNewMap}
       onOpenMap={handleOpenMap}
       onSaveMap={handleSaveMap}
       rightSidebarCollapsed={rightSidebarCollapsed}
       onToggleSidebar={() => setRightSidebarCollapsed(!rightSidebarCollapsed)}
     />
     ```

  **App.css updates:**

  1. Add `.canvas-area-wrapper` style:
     ```css
     .canvas-area-wrapper {
       position: relative;
       flex: 1;
       min-width: 0;
       overflow: hidden;
       display: flex;
       flex-direction: row;
     }
     ```

  2. Add `.minimap-overlay` style:
     ```css
     .minimap-overlay {
       position: absolute;
       top: 4px;
       right: 4px;
       z-index: 100;
       pointer-events: auto;
     }
     ```

  3. Remove the entire `.sidebar-collapse-toggle` block and its sub-rules (lines 90-129 — `.sidebar-collapse-toggle`, `.sidebar-collapse-toggle:hover`, `.sidebar-collapse-toggle::after`, `.sidebar-collapse-toggle.expanded::after`, `.sidebar-collapse-toggle.collapsed::after`).

  4. Keep `.right-sidebar-container` styles as-is (width: 130px, flex-shrink: 0, etc.) — they still apply when the sidebar is rendered.
  </action>
  <verify>
  Run `npm run typecheck` — should pass with no errors (App.tsx will have type errors until Task 2 adds the new props to ToolBar's Props interface, but the overall structure should be correct).
  </verify>
  <done>
  Minimap renders in absolute-positioned overlay inside canvas-area-wrapper. Sidebar is fully conditionally rendered based on rightSidebarCollapsed state. Old sidebar-collapse-toggle strip is removed. Two new props passed to ToolBar.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add sidebar toggle button to toolbar</name>
  <files>src/components/ToolBar/ToolBar.tsx</files>
  <action>
  1. Add icon imports at the top (line 22, in the existing `react-icons/lu` import block):
     ```tsx
     LuPanelRightOpen, LuPanelRightClose,
     ```
     - `LuPanelRightOpen` = panel open icon (shown when sidebar is collapsed, meaning "click to open")
     - `LuPanelRightClose` = panel close icon (shown when sidebar is expanded, meaning "click to close")

  2. Update the `Props` interface (around line 121) to add two new props:
     ```tsx
     interface Props {
       tilesetImage: HTMLImageElement | null;
       onNewMap: () => void;
       onOpenMap: () => void;
       onSaveMap: () => void;
       rightSidebarCollapsed: boolean;
       onToggleSidebar: () => void;
     }
     ```

  3. Destructure the new props in the component function (around line 128):
     ```tsx
     export const ToolBar: React.FC<Props> = ({
       tilesetImage,
       onNewMap,
       onOpenMap,
       onSaveMap,
       rightSidebarCollapsed,
       onToggleSidebar
     }) => {
     ```

  4. Add the sidebar toggle button AFTER the Map Settings button (line 1048) and BEFORE the `<div className="toolbar-spacer" />` (line 1050). Place it in the view controls group alongside grid and farplane toggles:
     ```tsx
     <button
       className={`toolbar-button ${!rightSidebarCollapsed ? 'active' : ''}`}
       onClick={onToggleSidebar}
       title={rightSidebarCollapsed ? 'Show Animations Panel' : 'Hide Animations Panel'}
     >
       {rightSidebarCollapsed ? <LuPanelRightOpen size={16} /> : <LuPanelRightClose size={16} />}
     </button>
     ```
     The button shows as `active` (highlighted) when the sidebar IS visible (not collapsed). Icon switches between open/close variants to indicate the action that will happen on click.
  </action>
  <verify>
  Run `npm run typecheck` — must pass with zero errors. All new props are typed and wired correctly from App.tsx through to ToolBar.tsx.
  </verify>
  <done>
  Toolbar has a sidebar toggle button with LuPanelRightOpen/LuPanelRightClose icons. Button is active when sidebar is visible. Clicking toggles rightSidebarCollapsed state in App.tsx. TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with zero errors
2. Visual check: Minimap appears in top-right corner of canvas area
3. Visual check: Click toolbar toggle — animations panel collapses, canvas expands horizontally, minimap stays visible
4. Visual check: Click toolbar toggle again — animations panel re-appears with title bar and game object tool panel
5. Visual check: Toolbar button shows active state (highlighted) when sidebar is visible
6. Visual check: Toolbar button icon changes between open/close states
</verification>

<success_criteria>
- Minimap always visible in top-right corner overlay (SIDE-01)
- Animations panel collapses/expands via toolbar toggle (SIDE-02)
- Canvas expands when animations panel collapsed (SIDE-03)
- Expanded state preserves current stacked layout (SIDE-04)
- Game object tool panel follows animations panel collapse state (SIDE-05)
- Zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/80-sidebar-independence/80-01-SUMMARY.md`
</output>
