---
phase: 09-panel-redesign
plan: 03
type: execute
wave: 2
depends_on: [09-01]
files_modified:
  - src/components/ToolBar/Toolbar.tsx
  - src/components/ToolBar/ToolBar.css
  - src/components/MapCanvas/MapCanvas.tsx
  - src/components/MapCanvas/MapCanvas.css
autonomous: true

must_haves:
  truths:
    - "Toolbar buttons are icon-only without text labels"
    - "Toolbar buttons show tooltips on hover"
    - "Selection outline appears on canvas when placing multi-tile stamps"
    - "Selection outline is dashed white rectangle"
  artifacts:
    - path: "src/components/ToolBar/Toolbar.tsx"
      provides: "Compact icon-only toolbar"
      contains: "toolbar-label.*hidden"
    - path: "src/components/MapCanvas/MapCanvas.tsx"
      provides: "Selection preview outline on canvas"
      contains: "setLineDash"
  key_links:
    - from: "MapCanvas.tsx"
      to: "tileSelection"
      via: "draws outline based on selection size"
      pattern: "tileSelection\\.width.*tileSelection\\.height"
---

<objective>
Make toolbar compact (icon-only with tooltips) and add selection outline preview on canvas for multi-tile placement.

Purpose: Maximize canvas space with compact toolbar. Help users visually align multi-tile stamps before placing.
Output: Compact Photoshop/GIMP-style toolbar and canvas selection preview.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-panel-redesign/09-CONTEXT.md
@.planning/phases/09-panel-redesign/09-RESEARCH.md
@src/components/ToolBar/Toolbar.tsx
@src/components/ToolBar/ToolBar.css
@src/components/MapCanvas/MapCanvas.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make toolbar compact icon-only</name>
  <files>
    src/components/ToolBar/Toolbar.tsx
    src/components/ToolBar/ToolBar.css
  </files>
  <action>
Update Toolbar to be compact icon-only with tooltips:

1. In Toolbar.tsx:
   - Keep existing button structure but ensure `title` attribute is set for all buttons
   - Title format: "{Label} ({Shortcut})" e.g., "Pencil (B)", "Save Map (Ctrl+S)"
   - Remove or hide `.toolbar-label` spans (CSS will handle hiding)

2. In ToolBar.css:
   - Hide text labels: `.toolbar-label { display: none; }`
   - Reduce button size:
     ```css
     .toolbar-button {
       padding: 4px 6px;
       min-width: 28px;
       height: 28px;
     }
     ```
   - Adjust icon size if needed:
     ```css
     .toolbar-icon {
       font-size: 14px;
     }
     ```
   - Reduce toolbar height:
     ```css
     .toolbar {
       height: auto;
       padding: 2px 4px;
       gap: 2px;
     }
     ```
   - Keep active state styling for selected tool
   - Ensure minimum 24px click target (current 28px is fine)

3. Ensure tooltips work:
   - Native `title` attribute provides browser tooltip
   - Appears on hover with ~500ms delay (browser default)
   - Shows full label + shortcut

Note: Keep the map name display in the toolbar (right side) - just the buttons become compact.
  </action>
  <verify>
    - Visual: Toolbar is more compact (shorter height)
    - Visual: Only icons visible, no text labels
    - Interaction: Hover shows tooltip with label and shortcut
    - Interaction: All buttons still clickable and functional
  </verify>
  <done>Toolbar displays as compact icon-only with tooltips</done>
</task>

<task type="auto">
  <name>Task 2: Add selection outline preview on canvas</name>
  <files>
    src/components/MapCanvas/MapCanvas.tsx
    src/components/MapCanvas/MapCanvas.css
  </files>
  <action>
Add dashed selection outline on canvas when cursor is over map with multi-tile selection:

1. In MapCanvas.tsx, add selection preview drawing in the draw() function:

After drawing tiles and grid, before returning, add:
```typescript
// Draw selection preview at cursor position
if (cursorTile.x >= 0 && cursorTile.y >= 0 && currentTool === ToolType.PENCIL) {
  const { width, height } = tileSelection;
  const tilePixels = TILE_SIZE * viewport.zoom;

  // Calculate screen position for cursor tile
  const screenX = (cursorTile.x - viewport.x) * tilePixels;
  const screenY = (cursorTile.y - viewport.y) * tilePixels;

  // Draw dashed white outline
  ctx.strokeStyle = '#ffffff';
  ctx.lineWidth = 1;
  ctx.setLineDash([4, 4]);
  ctx.strokeRect(
    screenX,
    screenY,
    width * tilePixels,
    height * tilePixels
  );
  ctx.setLineDash([]); // Reset dash pattern
}
```

2. Ensure cursorTile state updates on mouse move:
   - Already exists: `const [cursorTile, setCursorTile] = useState({ x: -1, y: -1 });`
   - Already updated in handleMouseMove

3. Add dependency on cursorTile to draw callback:
   - Include cursorTile in useCallback dependencies for draw()

4. Consider also showing for TILE tool (check if ToolType.TILE exists, may be alias):
   - The outline should show for any tile-placing tool
   - Check ToolType enum for correct constant name

5. Only show outline when selection is multi-tile (width > 1 || height > 1) OR always show:
   - Per CONTEXT.md: "Selection outline should be visible on canvas when placing tiles"
   - Show for all selections (even 1x1) to indicate exact placement position

Note: The outline should NOT obscure the tile preview if one exists. Draw outline AFTER any tile preview rendering.
  </action>
  <verify>
    - Visual: Dashed white rectangle appears at cursor position on canvas
    - Visual: Rectangle size matches tile selection (1x1, 2x3, etc.)
    - Visual: Outline moves with cursor
    - Visual: Outline only shows when cursor is over canvas with pencil/tile tool
    - Interaction: Placing tiles works correctly with outline showing
  </verify>
  <done>Canvas shows dashed white selection outline at cursor position</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Compact toolbar:
   - Run `npm run electron:dev`
   - Confirm: Toolbar is shorter (reduced height)
   - Confirm: Only icons visible, no text labels
   - Confirm: Hover over any button shows tooltip
   - Confirm: All buttons functional (New, Open, Save, tools, etc.)
   - Confirm: Map name still displays on right side

2. Selection outline:
   - Select 1x1 tile in tileset
   - Move cursor over map canvas
   - Confirm: White dashed 16x16 outline follows cursor
   - Select 3x2 tile region in tileset
   - Move cursor over map canvas
   - Confirm: White dashed 48x32 (scaled) outline follows cursor
   - Click to place tiles
   - Confirm: Tiles placed correctly, outline still works

3. Tool states:
   - Switch to Select tool: No outline (not placing tiles)
   - Switch to Pencil tool: Outline appears
   - Switch to Fill tool: Consider if outline appropriate (likely yes)
   - Switch to Line tool: Outline may not apply (uses line drawing)

4. Edge cases:
   - Zoom in/out: Outline scales correctly
   - Scroll map: Outline position updates correctly
   - Cursor leaves canvas: Outline disappears
</verification>

<success_criteria>
- Toolbar buttons are icon-only (labels hidden via CSS)
- Toolbar height is reduced (~28-32px vs previous larger size)
- All buttons show tooltips on hover with label + shortcut
- Canvas displays dashed white selection outline at cursor position
- Outline size matches current tile selection dimensions
- Outline scales with zoom level
- All existing functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/09-panel-redesign/09-03-SUMMARY.md`
</output>
