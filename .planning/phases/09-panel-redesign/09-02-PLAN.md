---
phase: 09-panel-redesign
plan: 02
type: execute
wave: 2
depends_on: [09-01]
files_modified:
  - src/components/AnimationPanel/AnimationPanel.tsx
  - src/components/AnimationPanel/AnimationPanel.css
autonomous: true

must_haves:
  truths:
    - "Animation previews display at 16x16 actual tile size"
    - "Hex labels show without leading zero (D5, not 0D5)"
    - "Hex labels appear only on hover or selection"
    - "Animation panel scrolls vertically to access all animations"
    - "Frame offset popup appears when animation is selected"
  artifacts:
    - path: "src/components/AnimationPanel/AnimationPanel.tsx"
      provides: "Redesigned animation panel with 16x16 previews"
      contains: "ANIM_PREVIEW_SIZE = 16"
    - path: "src/components/AnimationPanel/AnimationPanel.css"
      provides: "Updated styling for compact animations"
  key_links:
    - from: "AnimationPanel"
      to: "useEditorStore"
      via: "setSelectedTile for animation placement"
      pattern: "setSelectedTile.*ANIMATED_FLAG"
---

<objective>
Redesign AnimationPanel to display smaller 16x16 previews matching SEdit density, with hex labels on hover/selection only.

Purpose: Fit more animations on screen, match SEdit's compact visual style.
Output: Redesigned animation panel with 16x16 previews and improved UX.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-panel-redesign/09-CONTEXT.md
@.planning/phases/09-panel-redesign/09-RESEARCH.md
@src/components/AnimationPanel/AnimationPanel.tsx
@src/components/AnimationPanel/AnimationPanel.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign animation preview rendering</name>
  <files>
    src/components/AnimationPanel/AnimationPanel.tsx
  </files>
  <action>
Update AnimationPanel.tsx to render 16x16 animation previews:

1. Change constants:
   - `ANIM_PREVIEW_SIZE = 16` (was 48)
   - `VISIBLE_ANIMATIONS = 20` (was 8 - more fit now)
   - Add `PREVIEW_PADDING = 4` for spacing
   - Add `ITEM_HEIGHT = ANIM_PREVIEW_SIZE + PREVIEW_PADDING * 2` (24px per row)

2. Add hover state tracking:
   - Add `const [hoveredAnimId, setHoveredAnimId] = useState<number | null>(null);`
   - Track mouse position to determine hovered animation

3. Update draw() function for 16x16 previews:
   - Draw animation frames at actual 16x16 size (not scaled up)
   - Position: x=4 (padding), y based on row index
   - Background per item: subtle darker stripe for alternating rows

4. Update hex label rendering:
   - Only show hex label when: `hoveredAnimId === anim.id || selectedAnimId === anim.id`
   - Format: `anim.id.toString(16).toUpperCase()` (NO padStart - shows "D5" not "0D5")
   - Position: to the right of the preview (x = 24)
   - Font: 9px monospace, white color

5. Add mouse move handler for hover tracking:
```typescript
const handleMouseMove = (e: React.MouseEvent) => {
  const canvas = canvasRef.current;
  if (!canvas) return;
  const rect = canvas.getBoundingClientRect();
  const y = e.clientY - rect.top;
  const idx = scrollOffset + Math.floor(y / ITEM_HEIGHT);
  const anims = getAnimations();
  if (idx >= 0 && idx < anims.length) {
    setHoveredAnimId(anims[idx].id);
  } else {
    setHoveredAnimId(null);
  }
};

const handleMouseLeave = () => {
  setHoveredAnimId(null);
};
```

6. Update canvas dimensions:
   - Height: `VISIBLE_ANIMATIONS * ITEM_HEIGHT`
   - Width: Keep flexible based on container (or set to 120px minimum)

7. Update click handling to use new ITEM_HEIGHT for row calculation.

8. Keep frame offset controls - show inline below canvas when animation selected.

Note: Keep the "All/Defined" toggle button functionality.
  </action>
  <verify>
    - TypeScript compiles: `npm run typecheck`
    - Visual: Animation previews are 16x16 pixels
    - Visual: More animations visible at once (~20 vs 8)
    - Interaction: Hex labels appear on hover
    - Interaction: Selected animation shows hex label
  </verify>
  <done>Animation previews render at 16x16 with hex labels on hover/selection only</done>
</task>

<task type="auto">
  <name>Task 2: Update AnimationPanel styling</name>
  <files>
    src/components/AnimationPanel/AnimationPanel.css
  </files>
  <action>
Update AnimationPanel.css for new compact layout:

1. Remove old `.panel-header` styling (title bar now in App.tsx container)

2. Update `.animation-panel`:
   - `flex: 1` to fill container
   - `display: flex; flex-direction: column`
   - `overflow: hidden`
   - Remove any fixed heights

3. Update `.animation-canvas`:
   - `flex: 1` to take available space
   - `min-height: 200px` (ensure minimum visible area)
   - `cursor: pointer`

4. Style `.animation-controls` (frame offset section):
   - `padding: 8px`
   - `background: var(--bg-tertiary)`
   - `border-top: 1px solid var(--border-default)`

5. Update `.toggle-button` (All/Defined toggle):
   - Position in top-right of animation-panel (not in title bar)
   - Small button styling: padding 2px 6px, font-size 10px
   - `position: absolute; top: 4px; right: 4px`
   - Add `position: relative` to `.animation-panel` to contain it

6. Remove `.animation-info` styling (count display) or make it more compact:
   - `font-size: 10px`
   - `color: var(--text-tertiary)`
   - `padding: 4px 8px`

7. Style hover/selection states:
   - Use CSS for visual feedback where possible
   - Keep canvas-based rendering for actual animation drawing
  </action>
  <verify>
    - Visual: Animation panel fills available height
    - Visual: Frame offset controls visible when animation selected
    - Visual: Toggle button positioned cleanly
    - Visual: Overall compact appearance matching SEdit density
  </verify>
  <done>AnimationPanel CSS updated for compact 16x16 layout</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Animation preview size:
   - Run `npm run electron:dev`
   - Confirm: Animation previews are 16x16 pixels (actual tile size)
   - Confirm: Many more animations visible without scrolling (~20)

2. Hex label behavior:
   - Hover over animation: Hex label appears (e.g., "D5")
   - Move mouse away: Hex label disappears
   - Click animation: Hex label stays visible (selected)
   - Labels do NOT have leading zero (D5, not 0D5)

3. Frame offset:
   - Select an animation with defined frames
   - Frame offset slider appears below canvas
   - Can adjust offset 0-127
   - "Use" button places animation tile

4. Scrolling:
   - Scroll wheel navigates animation list
   - Can reach all 256 animation slots (or just defined ones in filtered mode)

5. All/Defined toggle:
   - Toggle button switches between showing all 256 vs only defined
   - Scroll position resets when toggling
</verification>

<success_criteria>
- Animation previews are 16x16 pixels (actual tile size)
- Hex labels display without leading zero (D5, not 0D5)
- Hex labels only appear on hover or selection
- More animations visible at once (~20 vs previous 8)
- Frame offset controls work correctly
- Scrolling reaches all animations
</success_criteria>

<output>
After completion, create `.planning/phases/09-panel-redesign/09-02-SUMMARY.md`
</output>
