---
phase: 09-panel-redesign
plan: 04
type: execute
wave: 3
depends_on: [09-01, 09-02, 09-03]
files_modified:
  - src/components/TilesetPanel/TilesetPanel.tsx
  - src/components/TilePalette/TilePalette.tsx
  - src/components/TilesetPanel/TilesetPanel.css
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Full tileset image is visible in tiles panel without internal vertical scrolling"
    - "Tileset stretches/fits to panel width dynamically"
  artifacts:
    - path: "src/components/TilePalette/TilePalette.tsx"
      provides: "fullHeight prop that disables VISIBLE_ROWS limit"
      contains: "fullHeight"
    - path: "src/components/TilesetPanel/TilesetPanel.tsx"
      provides: "Passes compact and fullHeight props to TilePalette"
      contains: "compact"
  key_links:
    - from: "src/components/TilesetPanel/TilesetPanel.tsx"
      to: "src/components/TilePalette/TilePalette.tsx"
      via: "compact and fullHeight props"
      pattern: "<TilePalette.*compact.*fullHeight"
---

<objective>
Fix two verification gaps in Phase 9 Panel Redesign:
1. Tileset shows only 12 rows with internal scrolling (should show full tileset)
2. Tileset renders at fixed 640px width (should stretch to panel width)

Purpose: Complete Phase 9 success criteria #5 and #6 that failed verification
Output: TilePalette with dynamic height/width when used in TilesetPanel context
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-panel-redesign/09-VERIFICATION.md
@src/components/TilePalette/TilePalette.tsx
@src/components/TilesetPanel/TilesetPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add fullHeight prop to TilePalette for dynamic height</name>
  <files>src/components/TilePalette/TilePalette.tsx</files>
  <action>
Add a `fullHeight` boolean prop to TilePalette that, when true:
1. Sets canvas height to full tileset height (tilesetImage.height) instead of visibleRows * TILE_SIZE
2. Disables scroll functionality (no wheel handling, scrollOffset stays 0)
3. Adjusts visibleRows calculation to use totalRows when fullHeight=true

Specific changes:
- Add `fullHeight?: boolean;` to Props interface (line 11-15)
- In the ResizeObserver effect (line 153-173):
  - When fullHeight=true: `canvas.height = tilesetImage ? tilesetImage.height : totalRows * TILE_SIZE`
  - When fullHeight=false: keep existing `visibleRows * TILE_SIZE` behavior
- In draw() function: when fullHeight=true, use totalRows instead of visibleRows for rendering
- In handleWheel: early return if fullHeight=true (no scrolling needed)
- Update visibleRows logic: `const effectiveVisibleRows = fullHeight ? totalRows : visibleRows;`

Keep backward compatibility: default fullHeight=false maintains current behavior for AnimationPanel usage.
  </action>
  <verify>
TypeScript compiles without errors: `npm run typecheck`
TilePalette still works in AnimationPanel (fullHeight=false, existing behavior)
  </verify>
  <done>
TilePalette accepts fullHeight prop. When fullHeight=true, canvas height equals full tileset height and scrolling is disabled.
  </done>
</task>

<task type="auto">
  <name>Task 2: Pass compact and fullHeight props from TilesetPanel</name>
  <files>src/components/TilesetPanel/TilesetPanel.tsx, src/components/TilesetPanel/TilesetPanel.css</files>
  <action>
Update TilesetPanel to pass the required props to TilePalette:

In TilesetPanel.tsx (line 18):
- Change: `<TilePalette tilesetImage={tilesetImage} />`
- To: `<TilePalette tilesetImage={tilesetImage} compact fullHeight />`

This enables:
- `compact` - Canvas width uses container.clientWidth (dynamic) instead of fixed 640px
- `fullHeight` - Canvas height uses full tileset height instead of VISIBLE_ROWS limit

In TilesetPanel.css:
- Add `overflow-y: auto;` to `.tileset-panel-body` to allow outer panel scrolling when tileset is taller than panel
- This provides the expected behavior: panel scrolls to show full tileset, not internal TilePalette scroll

Result: Tileset stretches to fill panel width and shows full height. Panel divider controls how much is visible. User scrolls the panel (not internally) if tileset is taller than available space.
  </action>
  <verify>
Run app: `npm run electron:dev`
Visual check:
1. Tileset panel shows full tileset width (not fixed 640px, stretches to panel)
2. Tileset shows more than 12 rows (full tileset visible if panel tall enough)
3. Dragging panel divider up reveals more tileset
4. If tileset taller than panel, panel itself scrolls (not internal TilePalette scroll)
  </verify>
  <done>
TilesetPanel passes compact and fullHeight props. Tileset displays at dynamic width matching panel width. Full tileset height is rendered, with panel-level scrolling if needed.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Width stretching (Gap 2 fix)**
   - Resize browser window horizontally
   - Tileset panel width changes, tileset stretches to match
   - No horizontal scrollbar within tileset

2. **Full height display (Gap 1 fix)**
   - Drag panel divider to make tileset panel taller
   - More rows of tileset become visible
   - No internal scroll buttons/wheel needed within TilePalette
   - Panel scrollbar appears if tileset exceeds panel height

3. **Backward compatibility**
   - AnimationPanel still shows limited rows with scroll (fullHeight=false by default)
   - AnimationPanel wheel scrolling still works

4. **Tile selection still works**
   - Click tile in tileset: selected tile updates
   - Drag to select multiple tiles: selection rectangle works
   - Selected tiles can be placed on canvas
</verification>

<success_criteria>
- [ ] Full tileset image visible without internal TilePalette scrolling
- [ ] Tileset stretches/fits to panel width dynamically
- [ ] Panel divider controls visible tileset area
- [ ] AnimationPanel unchanged (backward compatible)
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-panel-redesign/09-04-SUMMARY.md`
</output>
