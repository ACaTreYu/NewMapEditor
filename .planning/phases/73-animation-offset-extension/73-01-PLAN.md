---
phase: 73-animation-offset-extension
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/REQUIREMENTS.md
autonomous: true

must_haves:
  truths:
    - "User can set animation offset for any animated tile placement (not just spawn/warp)"
    - "Placed animated tiles (all types) encode the current offset value"
    - "Picker tool extracts offset from any animated tile and syncs to animation panel"
  artifacts:
    - path: "src/components/AnimationPanel/AnimationPanel.tsx"
      provides: "Offset encoding for all animated tile types at selection time"
      contains: "ANIMATED_FLAG | (animationOffsetInput << 8) | animId"
    - path: "src/components/MapCanvas/MapCanvas.tsx"
      provides: "Picker offset extraction for all animated tiles"
      contains: "getFrameOffset(pickedTile)"
    - path: "src/core/map/TileEncoding.ts"
      provides: "Generic makeAnimatedTile and getFrameOffset utilities"
      exports: ["makeAnimatedTile", "getFrameOffset", "isAnimatedTile"]
    - path: "src/components/StatusBar/StatusBar.tsx"
      provides: "Offset display for all animated tiles in status bar"
      contains: "Offset:"
  key_links:
    - from: "src/components/AnimationPanel/AnimationPanel.tsx"
      to: "globalSlice.animationOffsetInput"
      via: "useEditorStore subscription"
      pattern: "animationOffsetInput"
    - from: "src/components/AnimationPanel/AnimationPanel.tsx"
      to: "globalSlice.selectedTile"
      via: "setSelectedTile with pre-encoded offset"
      pattern: "setSelectedTile.*animatedTile"
    - from: "src/components/MapCanvas/MapCanvas.tsx"
      to: "globalSlice.animationOffsetInput"
      via: "setAnimationOffsetInput on picker extraction"
      pattern: "setAnimationOffsetInput.*offset"
---

<objective>
Verify that animation offset control already works for ALL animated tile types (not just spawn/warp) and mark ANIM-01 as complete.

Purpose: Research and code analysis confirm that offset encoding, placement, picker extraction, and status bar display already work generically for all 256 animation types. This plan performs code-level verification of the existing behavior and updates documentation to reflect completion.

Output: ANIM-01 marked done in REQUIREMENTS.md, verification evidence documented.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/73-animation-offset-extension/73-RESEARCH.md
@src/components/AnimationPanel/AnimationPanel.tsx
@src/components/MapCanvas/MapCanvas.tsx
@src/core/map/TileEncoding.ts
@src/components/StatusBar/StatusBar.tsx
@src/core/editor/slices/globalSlice.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify offset encoding works for all animated tile types</name>
  <files>.planning/REQUIREMENTS.md</files>
  <action>
Perform code-level verification of the four critical paths that together satisfy ANIM-01. This is a VERIFICATION task, not an implementation task. The functionality already exists.

**Verification steps (code inspection):**

1. **AnimationPanel offset encoding** — Confirm that AnimationPanel.tsx encodes offset for ALL animation IDs, not just spawn/warp. Check lines where `ANIMATED_FLAG | (animationOffsetInput << 8) | animId` is used. Verify there is NO filter by animId (no special-casing for 0xA3-0xA6, 0xFA, 0x9E). Expected: The encoding applies to any animId from 0x00 to 0xFF.

2. **Placement tool passthrough** — Confirm that pencil, fill, line, and rect tools in MapCanvas.tsx place `selectedTile` verbatim without stripping or modifying the offset bits. Search for `selectedTile` usage in placement handlers. Expected: No call to `makeAnimatedTile()` or bit manipulation on the tile value at placement time.

3. **Picker offset extraction** — Confirm that MapCanvas.tsx picker extracts offset from ALL animated tiles using `getFrameOffset(pickedTile)` without filtering by animId. The `isAnimatedTile()` check should be the only gate. Expected: The `setAnimationOffsetInput(offset)` call happens for any animated tile, not just specific animation IDs.

4. **Offset rebuild on input change** — Confirm that AnimationPanel.tsx `handleOffsetChange` rebuilds `selectedTile` when in anim mode, regardless of which animId is selected. Expected: The rebuild uses `selectedAnimId` (which can be any value 0x00-0xFF), not a hardcoded list.

5. **StatusBar display** — Confirm that StatusBar.tsx shows offset for any animated tile (bit 0x8000 check), not just specific animation IDs.

**If all 5 checks pass:** Update `.planning/REQUIREMENTS.md`:
- Change `- [ ] **ANIM-01**:` to `- [x] **ANIM-01**:`
- Change the traceability row from `| ANIM-01 | Phase 73 | Pending |` to `| ANIM-01 | Phase 73 | Done |`
- Update the last-updated date to 2026-02-16

**If any check fails:** Fix the specific issue found. Based on research, all checks are expected to pass without code changes.
  </action>
  <verify>
Run `npm run typecheck` to confirm no type errors exist. Grep for the five critical patterns:
1. `grep "ANIMATED_FLAG.*animationOffsetInput.*animId"` in AnimationPanel.tsx (encoding)
2. `grep "getFrameOffset(pickedTile)"` in MapCanvas.tsx (picker extraction)
3. `grep "setAnimationOffsetInput"` in MapCanvas.tsx (picker sync)
4. `grep "Offset:"` in StatusBar.tsx (status bar display)
5. Confirm REQUIREMENTS.md shows `[x]` for ANIM-01
  </verify>
  <done>
All five verification checks pass: (1) AnimationPanel encodes offset for any animId, (2) placement tools pass selectedTile verbatim, (3) picker extracts offset from any animated tile, (4) offset change rebuilds selectedTile for any animId, (5) status bar shows offset for any animated tile. ANIM-01 marked as done in REQUIREMENTS.md.
  </done>
</task>

</tasks>

<verification>
- `npm run typecheck` passes with zero errors
- REQUIREMENTS.md shows `[x]` for ANIM-01
- REQUIREMENTS.md traceability shows `Done` for ANIM-01
- Code inspection confirms no animId filtering in offset encoding, extraction, or display paths
</verification>

<success_criteria>
ANIM-01 requirement verified as already satisfied by existing code and marked complete in REQUIREMENTS.md. No code changes needed (unless verification reveals a bug).
</success_criteria>

<output>
After completion, create `.planning/phases/73-animation-offset-extension/73-01-SUMMARY.md`
</output>
