---
phase: 46-zoom-controls-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/StatusBar/StatusBar.tsx
  - src/components/StatusBar/StatusBar.css
autonomous: true

must_haves:
  truths:
    - "User types a zoom percentage and viewport zooms to that level"
    - "User drags zoom slider and viewport zoom updates in real-time"
    - "User clicks preset button (25%, 50%, 100%, 200%, 400%) and viewport zooms to that preset"
    - "User presses Ctrl+0 and viewport resets to 100%"
    - "User presses Ctrl+= and viewport zooms in to next preset"
    - "User presses Ctrl+- and viewport zooms out to previous preset"
    - "Mouse wheel zoom-to-cursor continues working unchanged"
    - "Zoom controls disable/clamp at min 25% and max 400%"
  artifacts:
    - path: "src/components/StatusBar/StatusBar.tsx"
      provides: "Zoom slider, numeric input, preset buttons, keyboard shortcuts"
      contains: "ZOOM_PRESETS"
    - path: "src/components/StatusBar/StatusBar.css"
      provides: "Zoom control styling (slider track/thumb, input, preset buttons)"
      contains: "zoom-slider"
  key_links:
    - from: "src/components/StatusBar/StatusBar.tsx"
      to: "Zustand viewport.zoom"
      via: "setViewport({ zoom: clampedZoom })"
      pattern: "setViewport.*zoom"
    - from: "src/components/StatusBar/StatusBar.tsx"
      to: "window keydown listener"
      via: "useEffect with Ctrl+0/+/- handling"
      pattern: "addEventListener.*keydown"
---

<objective>
Add professional zoom controls to the status bar: a range slider, numeric percentage input, preset buttons (25%, 50%, 100%, 200%, 400%), and keyboard shortcuts (Ctrl+0/+/-). All controls sync through Zustand's setViewport, preserving existing mouse wheel zoom-to-cursor behavior.

Purpose: Complete the zoom control story (ZOOM-01 through ZOOM-05) for the v2.6 milestone. Users currently have only mouse wheel zoom -- this adds precise control via typed values, slider, presets, and keyboard shortcuts.

Output: Updated StatusBar.tsx and StatusBar.css with fully functional zoom controls.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/46-zoom-controls-ui/46-RESEARCH.md

@src/components/StatusBar/StatusBar.tsx
@src/components/StatusBar/StatusBar.css
@src/styles/variables.css
@src/core/editor/slices/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add zoom controls to StatusBar component</name>
  <files>src/components/StatusBar/StatusBar.tsx</files>
  <action>
Modify StatusBar.tsx to add zoom controls. The current component displays a static "Zoom: {percent}%" field. Replace this with an interactive zoom controls section.

**Constants** (define at top of file, outside component):
```typescript
const ZOOM_PRESETS = [0.25, 0.5, 1, 2, 4];
const ZOOM_MIN = 0.25;
const ZOOM_MAX = 4;
```

**Store access:** Add `setViewport` to the existing useShallow selector (it already reads `viewport`).

**handleZoomChange function:** Clamps to [ZOOM_MIN, ZOOM_MAX] then calls `setViewport({ zoom: clampedZoom })`. Used by all zoom controls.

**handleZoomInput function:** For the number input. Parse `parseInt(e.target.value, 10)`, guard against NaN, divide by 100 to convert percentage to multiplier, pass to handleZoomChange.

**Zoom controls layout** (replaces the existing `status-field-zoom` div):
1. **Zoom out button** (-): calls handleZoomChange with previous preset from ZOOM_PRESETS (using `[...ZOOM_PRESETS].reverse().find(p => p < viewport.zoom)`). Falls back to `Math.max(ZOOM_MIN, viewport.zoom - 0.25)`. Disabled when `viewport.zoom <= ZOOM_MIN`.
2. **Range slider**: `<input type="range" min={ZOOM_MIN} max={ZOOM_MAX} step={0.01} value={viewport.zoom}>`. onChange calls handleZoomChange with `parseFloat(e.target.value)`. Class: `zoom-slider`. aria-label: "Zoom level".
3. **Zoom in button** (+): calls handleZoomChange with next preset from ZOOM_PRESETS (using `ZOOM_PRESETS.find(p => p > viewport.zoom)`). Falls back to `Math.min(ZOOM_MAX, viewport.zoom + 0.25)`. Disabled when `viewport.zoom >= ZOOM_MAX`.
4. **Number input**: `<input type="number" min={25} max={400} step={1} value={Math.round(viewport.zoom * 100)}>`. onChange calls handleZoomInput. Class: `zoom-input`. Width: ~48px. aria-label: "Zoom percentage". Followed by a `<span className="zoom-percent-label">%</span>`.
5. **Preset buttons**: Map over ZOOM_PRESETS. Each `<button>` shows `{preset * 100}%`. Active class when `Math.abs(viewport.zoom - preset) < 0.01`. onClick calls `handleZoomChange(preset)`.

**Keyboard shortcuts** (useEffect with window keydown listener):
- Guard: if `e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement`, return early (don't intercept typing in inputs).
- Guard: if `!(e.ctrlKey || e.metaKey)`, return early.
- `e.key === '0'`: preventDefault, setViewport({ zoom: 1 }) -- reset to 100%.
- `e.key === '=' || e.key === '+'`: preventDefault, zoom in to next preset or +0.25.
- `e.key === '-' || e.key === '_'`: preventDefault, zoom out to previous preset or -0.25.
- Dependencies: [viewport.zoom, setViewport].

**Important:** Do NOT touch the existing mouse wheel handling in MapCanvas.tsx. ZOOM-05 is preserved by not modifying that code.

**Layout order in JSX:** coords field, tile field, zoom controls section (with class `status-field-zoom-controls`), tool field, selection field, spacer, resize grip.
  </action>
  <verify>Run `npm run typecheck` -- zero TypeScript errors.</verify>
  <done>StatusBar shows zoom slider, +/- buttons, numeric input with % label, and 5 preset buttons. All controls call setViewport with clamped zoom values. Keyboard shortcuts registered for Ctrl+0/+/-.</done>
</task>

<task type="auto">
  <name>Task 2: Style zoom controls with design token CSS</name>
  <files>src/components/StatusBar/StatusBar.css</files>
  <action>
Add zoom control styles to StatusBar.css. Use existing design tokens from variables.css (--slider-track, --slider-thumb, --slider-thumb-active, --input-bg, --input-border, --input-focus, --focus-ring, etc.).

**Remove** the `.status-field-zoom` rule (no longer needed -- replaced by zoom controls section).

**Add these rules:**

1. `.status-field-zoom-controls` -- Flex container, `align-items: center`, `gap: var(--space-0_5)`. No border (not a sunken field like the others -- it's a control group). `margin: 0 var(--space-0_5)` for slight separation from adjacent fields.

2. `.zoom-slider` -- Custom range input:
   - Reset: `-webkit-appearance: none; appearance: none; background: transparent; cursor: pointer; width: 100px;`
   - WebKit track (`::-webkit-slider-runnable-track`): `background: var(--slider-track); height: 4px; border-radius: var(--radius-full);`
   - Firefox track (`::-moz-range-track`): same as WebKit track.
   - WebKit thumb (`::-webkit-slider-thumb`): `-webkit-appearance: none; appearance: none; width: 12px; height: 12px; border-radius: 50%; background: var(--slider-thumb); border: 1px solid var(--border-default); margin-top: -4px;`
   - Firefox thumb (`::-moz-range-thumb`): same dimensions, no margin-top needed.
   - Hover on thumb: `background: var(--slider-thumb-active);`

3. `.zoom-btn` -- Small +/- buttons:
   - `width: 20px; height: 20px; padding: 0; display: flex; align-items: center; justify-content: center;`
   - `border: 1px solid var(--border-default); border-radius: var(--radius-sm); background: var(--surface); color: var(--text-primary); font-size: var(--font-size-xs); cursor: pointer; line-height: 1;`
   - Hover: `background: var(--bg-hover);`
   - Active: `background: var(--bg-active);`
   - Disabled: `opacity: 0.4; cursor: not-allowed; pointer-events: none;`

4. `.zoom-input` -- Number input:
   - `width: 42px; padding: var(--space-px) var(--space-0_25); border: 1px solid var(--input-border); border-radius: var(--radius-sm); background: var(--input-bg); color: var(--text-primary); font-size: var(--font-size-xs); text-align: right; font-family: var(--font-mono);`
   - Focus: `outline: none; border-color: var(--input-focus); box-shadow: 0 0 0 2px var(--focus-ring);`
   - Hide spinners: `::-webkit-inner-spin-button, ::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }` and `[type=number] { -moz-appearance: textfield; }`

5. `.zoom-percent-label` -- `font-size: var(--font-size-xs); color: var(--text-secondary);`

6. `.zoom-preset-btn` -- Preset buttons:
   - `padding: var(--space-px) var(--space-0_5); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); background: var(--surface); color: var(--text-secondary); font-size: var(--font-size-2xs); cursor: pointer; white-space: nowrap; line-height: 1;`
   - Hover: `background: var(--bg-hover); color: var(--text-primary);`
   - Active click: `background: var(--bg-active);`
   - `.active` state (current zoom matches preset): `background: var(--accent-primary); color: var(--text-on-accent); border-color: var(--accent-primary);`
   - `.active:hover`: `background: var(--accent-hover);`

All styles should be compact since this lives in a 22px-min-height status bar. Keep buttons and inputs small.
  </action>
  <verify>Run `npm run electron:dev` and visually confirm: slider renders with custom track/thumb, input shows percentage, preset buttons are visible with active highlighting, +/- buttons appear at slider ends. All controls fit within the status bar height.</verify>
  <done>Zoom controls are styled consistently with the OKLCH design token system. Slider has custom track/thumb, input is compact with hidden spinners, preset buttons highlight when active, +/- buttons show disabled state at limits.</done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with zero errors
2. `npm run electron:dev` launches successfully
3. Status bar shows: [coords] [tile] [-][slider][+] [input%] [25%][50%][100%][200%][400%] [tool] [sel]
4. Dragging slider updates zoom in real-time
5. Typing "150" in input and pressing Enter/Tab sets zoom to 150%
6. Clicking "50%" preset button zooms to 50%, button shows active highlight
7. Ctrl+0 resets to 100%, Ctrl+= zooms in, Ctrl+- zooms out
8. Mouse wheel zoom-to-cursor continues working (no changes to MapCanvas.tsx)
9. At 25% zoom: zoom out button and 25% preset are disabled/highlighted; slider at minimum
10. At 400% zoom: zoom in button and 400% preset are disabled/highlighted; slider at maximum
</verification>

<success_criteria>
- All 5 zoom requirements (ZOOM-01 through ZOOM-05) are satisfied
- Zoom slider, numeric input, preset buttons, and keyboard shortcuts all sync through setViewport
- Controls clamp to 0.25-4.0 range (25%-400%)
- Existing mouse wheel zoom-to-cursor behavior is unchanged
- No TypeScript errors
- Visual styling matches OKLCH design token system
</success_criteria>

<output>
After completion, create `.planning/phases/46-zoom-controls-ui/46-01-SUMMARY.md`
</output>
