---
phase: 02-layout-and-toolbar
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - package.json
  - src/App.tsx
  - src/App.css
  - src/components/TilePalette/TilePalette.css
autonomous: true

must_haves:
  truths:
    - "User sees map canvas taking full width and main vertical area"
    - "User sees bottom panel below canvas with resizable divider"
    - "User can drag divider to resize panel (10-60% range)"
    - "Panel size persists after app restart"
  artifacts:
    - path: "package.json"
      provides: "react-resizable-panels dependency"
      contains: "react-resizable-panels"
    - path: "src/App.tsx"
      provides: "Vertical PanelGroup layout"
      contains: "PanelGroup"
    - path: "src/App.css"
      provides: "Resize handle styling"
      contains: "resize-handle"
  key_links:
    - from: "src/App.tsx"
      to: "localStorage"
      via: "panel size persistence"
      pattern: "localStorage\\.(get|set)Item.*panel"
    - from: "src/App.tsx"
      to: "react-resizable-panels"
      via: "import PanelGroup"
      pattern: "from 'react-resizable-panels'"
---

<objective>
Restructure app layout with resizable vertical panels using react-resizable-panels. Map canvas takes main area, bottom panel holds tile palette with resizable divider.

Purpose: Achieves professional editor layout where canvas dominates viewport and user can adjust panel proportions to preference with persistence.

Output: App.tsx using PanelGroup for vertical layout, resizable divider between canvas and bottom panel, size persisted to localStorage.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-layout-and-toolbar/02-CONTEXT.md
@.planning/phases/02-layout-and-toolbar/02-RESEARCH.md
@.planning/phases/02-layout-and-toolbar/02-01-SUMMARY.md

@src/App.tsx
@src/App.css
@src/components/TilePalette/TilePalette.tsx
@src/components/TilePalette/TilePalette.css
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-resizable-panels and create vertical layout</name>
  <files>package.json, src/App.tsx, src/App.css</files>
  <action>
**Step 1: Install dependency**
```bash
npm install react-resizable-panels
```

**Step 2: Update App.tsx**

1. Add imports at top:
```typescript
import { Panel, PanelGroup, PanelResizeHandle } from 'react-resizable-panels';
```

2. Add state for initial panel sizes with lazy initialization from localStorage:
```typescript
const [panelSizes] = useState<number[]>(() => {
  const saved = localStorage.getItem('editor-panel-sizes');
  return saved ? JSON.parse(saved) : [80, 20]; // Default: 80% canvas, 20% bottom
});
```

3. Add layout change handler to persist sizes:
```typescript
const handleLayoutChange = useCallback((sizes: number[]) => {
  localStorage.setItem('editor-panel-sizes', JSON.stringify(sizes));
}, []);
```

4. Restructure JSX layout. Replace current structure:
```tsx
// OLD:
<div className="app-content">
  <MapCanvas tilesetImage={tilesetImage} />
  <div className="right-panels">
    <TilePalette tilesetImage={tilesetImage} />
    {showAnimations && <AnimationPanel tilesetImage={tilesetImage} />}
  </div>
  {showSettings && <MapSettingsPanel />}
</div>
```

With new vertical panel layout:
```tsx
<PanelGroup direction="vertical" onLayout={handleLayoutChange} className="app-content">
  <Panel defaultSize={panelSizes[0]} minSize={40} maxSize={90}>
    <div className="canvas-area">
      <MapCanvas tilesetImage={tilesetImage} />
    </div>
  </Panel>

  <PanelResizeHandle className="resize-handle" />

  <Panel defaultSize={panelSizes[1]} minSize={10} maxSize={60}>
    <div className="bottom-panel">
      <TilePalette tilesetImage={tilesetImage} />
      {showAnimations && <AnimationPanel tilesetImage={tilesetImage} />}
      {showSettings && <MapSettingsPanel />}
    </div>
  </Panel>
</PanelGroup>
```

Note: minSize/maxSize are percentages. 40% min for canvas, 10% min for bottom panel. This allows bottom panel to go up to 60% (100 - 40).

**Step 3: Update App.css**

1. Update .app-content to work with PanelGroup:
```css
.app-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
```

2. Add canvas-area styling:
```css
.canvas-area {
  width: 100%;
  height: 100%;
  overflow: hidden;
}
```

3. Add bottom-panel styling:
```css
.bottom-panel {
  display: flex;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background-color: var(--bg-secondary);
  border-top: 1px solid var(--border-color);
}
```

4. Add resize-handle styling per RESEARCH.md:
```css
.resize-handle {
  flex: 0 0 2px;
  background-color: var(--border-color);
  cursor: row-resize;
  position: relative;
  transition: background-color 0.15s ease;
}

.resize-handle:hover {
  background-color: var(--accent-color);
}

/* Expand hit target without changing visual size */
.resize-handle::before {
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  top: -4px;
  bottom: -4px;
}

/* Active state during drag */
.resize-handle[data-resize-handle-active] {
  background-color: var(--accent-color);
}
```

5. Remove .right-panels style (no longer used).
  </action>
  <verify>
Run `npm run typecheck` - should pass.
Run `npm run electron:dev` and verify:
- Canvas takes upper portion of window (default ~80%)
- Bottom panel with tile palette takes lower portion (default ~20%)
- Resize handle visible as thin line between sections
  </verify>
  <done>
PanelGroup layout installed and configured with canvas panel and bottom panel separated by resize handle.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enable resizing and verify persistence</name>
  <files>src/App.tsx, src/components/TilePalette/TilePalette.css</files>
  <action>
**Step 1: Verify resize functionality works**

The PanelGroup with onLayout callback should already enable resizing. Test by:
1. Running the app
2. Dragging the resize handle up/down
3. Observing live resize of both panels

**Step 2: Update TilePalette to fill available space**

Edit TilePalette.css to make palette adapt to container:
```css
.tile-palette {
  /* Remove fixed width: 660px */
  flex: 1;
  min-width: 660px;  /* Minimum to show full tileset row */
  background-color: var(--bg-secondary);
  border-left: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.palette-header {
  padding: 8px 12px;
  background-color: var(--bg-primary);
  color: var(--text-secondary);
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid var(--border-color);
}

.palette-canvas {
  display: block;
  margin: 4px;
  cursor: pointer;
  border: 1px solid var(--border-color);
}

.palette-info {
  padding: 8px 12px;
  color: var(--text-secondary);
  font-size: 11px;
  border-top: 1px solid var(--border-color);
}

.wall-selector {
  border-top: 1px solid var(--border-color);
}

.wall-select {
  width: calc(100% - 24px);
  margin: 8px 12px;
  padding: 8px;
  background-color: var(--bg-primary);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-primary);
  font-size: 12px;
  cursor: pointer;
}

.wall-select:focus {
  outline: none;
  border-color: var(--accent-color);
}

.wall-select option {
  background-color: var(--bg-primary);
  color: var(--text-primary);
}
```

**Step 3: Verify persistence works**

Test procedure:
1. Run app, resize panel to custom size (e.g., 30%)
2. Check localStorage in DevTools: `localStorage.getItem('editor-panel-sizes')` should show `[70,30]`
3. Refresh/restart app
4. Panel should restore to 30%

**Step 4: Handle edge case - small windows**

Per CONTEXT.md: "canvas wins - canvas keeps minimum size, panel shrinks more"

This is already handled by minSize={40} on canvas Panel (canvas always gets at least 40%). Verify by:
1. Resize window to small height
2. Canvas should maintain ~40% minimum
3. Bottom panel compresses
  </action>
  <verify>
Run `npm run electron:dev` and verify:
1. Dragging resize handle resizes panels in real-time
2. Panel sizes persist after app restart (check localStorage)
3. Canvas has minimum 40% height, bottom panel minimum 10%
4. On small windows, canvas maintains minimum while panel compresses
5. TilePalette displays correctly with theme colors
  </verify>
  <done>
Resizable divider fully functional with live resize, persistence to localStorage, and proper min/max constraints. Tile palette updated to use theme variables.
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes
2. `npm run electron:dev` launches with new layout
3. Map canvas fills upper portion of window
4. Bottom panel with tile palette fills lower portion
5. Resize handle visible as thin line, changes cursor on hover
6. Dragging resize handle resizes both panels live
7. Panel sizes persist after app restart
8. Canvas maintains minimum 40% on small windows
9. Theme colors apply to all restyled components
</verification>

<success_criteria>
- react-resizable-panels installed and integrated
- Vertical PanelGroup layout with MapCanvas and bottom panel
- Resize handle styled as thin line with hover effect
- Panel sizes persist to localStorage and restore on app start
- Min 40% canvas, min 10% bottom panel, max 60% bottom panel
- TilePalette uses CSS custom properties for theming
- Live resize during drag (no delayed reflow)
</success_criteria>

<output>
After completion, create `.planning/phases/02-layout-and-toolbar/02-02-SUMMARY.md`
</output>
