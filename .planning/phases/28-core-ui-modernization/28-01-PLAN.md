---
phase: 28-core-ui-modernization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/variables.css
  - src/components/AnimationPreview/AnimationPreview.css
  - src/components/GameObjectToolPanel/GameObjectToolPanel.css
  - src/components/MapSettingsDialog/MapSettingsDialog.css
  - src/components/TeamSelector/TeamSelector.css
  - src/components/ToolBar/ToolBar.css
autonomous: true

must_haves:
  truths:
    - "Changing --text-on-accent in variables.css updates all white-on-color text across the app"
    - "Changing --overlay-bg in variables.css updates the dialog backdrop opacity"
    - "Changing --focus-ring in variables.css updates all input focus outlines"
    - "Changing --space-0_5 in variables.css uniformly adjusts all 4px compact spacing"
    - "No component renders a color that cannot be controlled from variables.css (except title bar gradient)"
  artifacts:
    - path: "src/styles/variables.css"
      provides: "Complete design token system including compact spacing, typography scale, and semantic color tokens"
      contains: "--text-on-accent"
    - path: "src/components/AnimationPreview/AnimationPreview.css"
      provides: "Zero hardcoded colors"
    - path: "src/components/MapSettingsDialog/MapSettingsDialog.css"
      provides: "Zero hardcoded colors or rgba values"
    - path: "src/components/ToolBar/ToolBar.css"
      provides: "Zero hardcoded colors"
  key_links:
    - from: "src/components/*//*.css"
      to: "src/styles/variables.css"
      via: "var() references to new tokens"
      pattern: "var\\(--text-on-accent\\)|var\\(--text-warning\\)|var\\(--overlay-bg\\)|var\\(--focus-ring\\)"
---

<objective>
Add missing design tokens to variables.css and eliminate all hardcoded color values (hex and rgba) from component CSS files.

Purpose: Complete the design token system so every color in the UI is controlled via a single source of truth, enabling future theme-ability and consistent visual language.

Output: Updated variables.css with complete token set; all 7 hex color instances and 3 rgba instances replaced with var() references.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-core-ui-modernization/28-RESEARCH.md
@src/styles/variables.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add missing design tokens to variables.css</name>
  <files>src/styles/variables.css</files>
  <action>
Add the following tokens to variables.css in appropriate sections:

**Tier 1: Compact Spacing** (add after the existing --space-10 line, under a new sub-heading comment):
```css
/* Compact spacing (sub-8px for tight UI elements) */
--space-px: 1px;
--space-0_25: 2px;
--space-0_5: 4px;
--space-0_75: 6px;
--space-1_25: 10px;
--space-1_5: 12px;
```

**Tier 1: Typography** (add --font-size-2xs before --font-size-xs):
```css
--font-size-2xs: 9px;
--font-size-3xs: 10px;
```
Note: 10px is used extensively (20+ instances) so it needs its own token. 9px is used for tiny labels. The name --font-size-3xs for 10px might seem odd, but the existing scale goes xs=11px, sm=13px, base=14px. So 2xs=9px and a 10px token fits between 2xs and xs. Actually, use a better name: keep --font-size-2xs: 9px and add --font-size-2xs-plus: 10px.

Wait - simpler approach: Since 10px sits between 9px and 11px, name them:
```css
--font-size-2xs: 10px;
```
But 9px is also used. Let me use the research recommendation:
```css
--font-size-2xs: 9px;
```
And for 10px, just map it to a new token or use 2xs where 9px was and keep 10px values as-is since they're close to xs (11px). Actually, the cleanest approach: 9px maps to --font-size-2xs, 10px maps to --font-size-2xs (round up). This way we consolidate 9px and 10px to a single token. BUT that changes the visual appearance.

Better: Define both tokens:
```css
--font-size-2xs: 9px;   /* Tiny labels */
--font-size-xs-: 10px;  /* Small controls (between 2xs and xs) */
```
The name is awkward. Use:
```css
--font-size-2xs: 9px;
```
For 10px instances, use a separate approach - either round to 9px (--font-size-2xs) or 11px (--font-size-xs). Given this is a compact map editor UI where 1px font differences are negligible, consolidate:
- 9px → var(--font-size-2xs)
- 10px → var(--font-size-2xs) (acceptable 1px difference for compact UI)

This is the pragmatic choice - one token covers both tiny sizes.

**Tier 2: Semantic Aliases** (add after existing semantic aliases):
```css
/* Text on colored backgrounds */
--text-on-accent: #ffffff;

/* Status/warning text */
--text-warning: oklch(55% 0.2 50);

/* Overlay and focus */
--overlay-bg: rgba(0, 0, 0, 0.5);
--focus-ring: rgba(16, 132, 208, 0.2);

/* Canvas/preview backgrounds */
--canvas-checker-bg: var(--color-neutral-300);
```

For --text-warning, the current value is #cc4400 (a dark orange-red). Convert to OKLCH for consistency with the color system: oklch(55% 0.2 50) approximates #cc4400. Actually, since this is a semantic alias and only used once, just use the hex value directly: `--text-warning: #cc4400;` (keeping rgba/hex for non-OKLCH-friendly values is the established pattern from Phase 27 shadows).

Final token additions to variables.css:

After `--space-10: 80px;` add:
```
  /* Compact spacing (sub-8px for tight UI elements) */
  --space-px: 1px;
  --space-0_25: 2px;
  --space-0_5: 4px;
  --space-0_75: 6px;
  --space-1_25: 10px;
  --space-1_5: 12px;
```

Before `--font-size-xs: 11px;` add:
```
  --font-size-2xs: 9px;
```

After `--workspace-bg: var(--color-neutral-200);` (end of semantic aliases) add:
```
  /* Text on colored backgrounds */
  --text-on-accent: #ffffff;

  /* Status/warning colors */
  --text-warning: #cc4400;

  /* Overlay and focus */
  --overlay-bg: rgba(0, 0, 0, 0.5);
  --focus-ring: rgba(16, 132, 208, 0.2);

  /* Canvas/preview background */
  --canvas-checker-bg: var(--color-neutral-300);
```
  </action>
  <verify>
Read variables.css and confirm:
- --space-px, --space-0_25, --space-0_5, --space-0_75, --space-1_25, --space-1_5 exist
- --font-size-2xs exists
- --text-on-accent, --text-warning, --overlay-bg, --focus-ring, --canvas-checker-bg exist
- All values are correct
- File has no syntax errors (run `npm run typecheck` to verify CSS doesn't break build)
  </verify>
  <done>variables.css contains all new design tokens needed for Phase 28 color and spacing token migration</done>
</task>

<task type="auto">
  <name>Task 2: Replace all hardcoded colors with design tokens</name>
  <files>
    src/components/AnimationPreview/AnimationPreview.css
    src/components/GameObjectToolPanel/GameObjectToolPanel.css
    src/components/MapSettingsDialog/MapSettingsDialog.css
    src/components/TeamSelector/TeamSelector.css
    src/components/ToolBar/ToolBar.css
  </files>
  <action>
Replace every hardcoded hex color and rgba() value with the appropriate var() token:

**AnimationPreview.css:**
- Line 31: `background: #c0c0c0;` → `background: var(--canvas-checker-bg);`
- Line 106: `color: #ffffff;` (in .use-btn) → `color: var(--text-on-accent);`

**GameObjectToolPanel.css:**
- Line 45: `color: #cc4400;` (in .gotool-warning) → `color: var(--text-warning);`

**MapSettingsDialog.css:**
- Line 15: `background-color: rgba(0, 0, 0, 0.5);` (::backdrop) → `background-color: var(--overlay-bg);`
- Line 21: `color: #ffffff;` (in .dialog-title-bar) → `color: var(--text-on-accent);`
- Line 242: `box-shadow: 0 0 0 2px rgba(16, 132, 208, 0.2);` (.setting-number-input:focus) → `box-shadow: 0 0 0 2px var(--focus-ring);`
- Line 304: `box-shadow: 0 0 0 2px rgba(16, 132, 208, 0.2);` (.text-input:focus, .text-area:focus) → `box-shadow: 0 0 0 2px var(--focus-ring);`

**TeamSelector.css:**
- Line 31: `color: #ffffff;` (in .team-option:hover) → `color: var(--text-on-accent);`

**ToolBar.css:**
- Line 139: `color: #ffffff;` (in .toolbar-dropdown-item:hover) → `color: var(--text-on-accent);`
- Line 145: `color: #ffffff;` (in .toolbar-dropdown-item.selected) → `color: var(--text-on-accent);`

**Note about MapSettingsDialog.css title bar gradient:**
The `linear-gradient(to right, #000080, #1084d0)` on line 20 is a decorative gradient, not a semantic color. Leave it as-is - title bar gradients are intentionally unique and don't need tokenization. This matches the Phase 27 decision to keep title bar gradients as direct values.

After all replacements, verify with grep that no `#ffffff`, `#c0c0c0`, `#cc4400`, or `rgba(` patterns remain in these 5 files (except the title bar gradient hex values in MapSettingsDialog.css which are intentional).
  </action>
  <verify>
Run grep across all component CSS files:
- `grep -rn "#ffffff" src/components/ --include="*.css"` should return 0 matches
- `grep -rn "#c0c0c0" src/components/ --include="*.css"` should return 0 matches
- `grep -rn "#cc4400" src/components/ --include="*.css"` should return 0 matches
- `grep -rn "rgba(" src/components/ --include="*.css"` should return 0 matches
- `npm run typecheck` passes (no new errors)
  </verify>
  <done>Zero hardcoded hex colors and zero hardcoded rgba() values remain in any component CSS file (except intentional title bar gradient)</done>
</task>

</tasks>

<verification>
1. `grep -rn "#[0-9a-fA-F]\{3,8\}" src/components/ --include="*.css"` returns only the MapSettingsDialog title bar gradient (#000080, #1084d0)
2. `grep -rn "rgba(" src/components/ --include="*.css"` returns 0 matches
3. variables.css contains all new tokens: --text-on-accent, --text-warning, --overlay-bg, --focus-ring, --canvas-checker-bg, --space-px through --space-1_5, --font-size-2xs
4. `npm run typecheck` passes without new errors
</verification>

<success_criteria>
- All hardcoded hex color values replaced with var() references (except title bar gradient)
- All hardcoded rgba() values replaced with var() references
- variables.css contains complete token set for colors, compact spacing, and tiny font sizes
- Application builds and renders correctly
</success_criteria>

<output>
After completion, create `.planning/phases/28-core-ui-modernization/28-01-SUMMARY.md`
</output>
