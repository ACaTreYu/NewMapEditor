---
phase: 36-status-bar-ui-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/TilePalette/TilePalette.tsx
  - src/components/TilesetPanel/TilesetPanel.tsx
  - src/components/StatusBar/StatusBar.tsx
  - src/components/StatusBar/StatusBar.css
  - src/App.tsx
  - src/components/MapSettingsDialog/MapSettingsDialog.css
autonomous: true

must_haves:
  truths:
    - "Status bar shows tile ID and map coordinates (X/Y) when hovering over map canvas"
    - "Status bar shows tile ID and tileset coordinates (Col/Row) when hovering over tileset panel"
    - "Status bar clears tile info when cursor leaves both map canvas and tileset panel"
    - "Map Settings dialog tabs scroll vertically when content exceeds visible area at small window sizes"
  artifacts:
    - path: "src/components/TilePalette/TilePalette.tsx"
      provides: "onTileHover callback prop for tileset hover events"
      contains: "onTileHover"
    - path: "src/components/TilesetPanel/TilesetPanel.tsx"
      provides: "Pass-through of onTileHover from App to TilePalette"
      contains: "onTileHover"
    - path: "src/components/StatusBar/StatusBar.tsx"
      provides: "Display of hover source (map vs tileset) with appropriate coordinate labels"
      contains: "hoverSource"
    - path: "src/App.tsx"
      provides: "State lifting for tileset hover events alongside existing map hover"
      contains: "handleTilesetHover"
    - path: "src/components/MapSettingsDialog/MapSettingsDialog.css"
      provides: "Responsive scrollable tab content"
      contains: "calc"
  key_links:
    - from: "src/components/TilePalette/TilePalette.tsx"
      to: "src/App.tsx"
      via: "onTileHover callback prop"
      pattern: "onTileHover\\?"
    - from: "src/App.tsx"
      to: "src/components/StatusBar/StatusBar.tsx"
      via: "cursorTileId and hoverSource props"
      pattern: "hoverSource"
    - from: "src/components/TilesetPanel/TilesetPanel.tsx"
      to: "src/components/TilePalette/TilePalette.tsx"
      via: "onTileHover prop pass-through"
      pattern: "onTileHover"
---

<objective>
Add tile hover info to the status bar from both map canvas and tileset panel, and ensure Map Settings dialog tabs scroll properly at all window sizes.

Purpose: Complete the v2.1 milestone by providing professional-grade status bar feedback during map editing and ensuring all settings remain accessible regardless of window size.
Output: Updated StatusBar with hover source awareness, TilePalette with hover callback, and responsive dialog scrolling.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/StatusBar/StatusBar.tsx
@src/components/StatusBar/StatusBar.css
@src/components/TilePalette/TilePalette.tsx
@src/components/TilesetPanel/TilesetPanel.tsx
@src/components/Workspace/Workspace.tsx
@src/components/Workspace/ChildWindow.tsx
@src/App.tsx
@src/components/MapSettingsDialog/MapSettingsDialog.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire tileset hover to status bar and add source-aware display</name>
  <files>
    src/components/TilePalette/TilePalette.tsx
    src/components/TilesetPanel/TilesetPanel.tsx
    src/components/StatusBar/StatusBar.tsx
    src/components/StatusBar/StatusBar.css
    src/App.tsx
  </files>
  <action>
**TilePalette.tsx** — Add `onTileHover` callback prop:
1. Add to Props interface: `onTileHover?: (tileId: number | undefined, col: number, row: number) => void`
2. In `handleMouseMove`: after calculating `col` and `row` from mouse position (lines 213-225), call `onTileHover?.(tileId, col, row)` where `tileId = row * TILES_PER_ROW + col`. This must fire on every mouse move, not just during drag. Currently the function returns early if `!dragState.active` — the hover callback must fire BEFORE that early return check. Add a new block at the top of handleMouseMove that always runs:
   ```
   // Always calculate hover info regardless of drag state
   const canvas = canvasRef.current;
   if (canvas) {
     const rect = canvas.getBoundingClientRect();
     const offsetX = showRowLabels ? ROW_LABEL_WIDTH : 0;
     const hx = e.clientX - rect.left - offsetX;
     const hy = e.clientY - rect.top;
     if (hx >= 0) {
       const hCol = Math.floor(hx / TILE_SIZE);
       const hRow = Math.floor(hy / TILE_SIZE) + scrollOffset;
       const hTileId = hRow * TILES_PER_ROW + hCol;
       onTileHover?.(hTileId, hCol, hRow);
     } else {
       onTileHover?.(undefined, -1, -1);
     }
   }
   ```
   Then keep the existing early return for drag logic.
3. In `handleMouseLeave`: add `onTileHover?.(undefined, -1, -1)` BEFORE the existing drag finalization logic.

**TilesetPanel.tsx** — Pass through `onTileHover`:
1. Add to Props interface: `onTileHover?: (tileId: number | undefined, col: number, row: number) => void`
2. Pass `onTileHover={onTileHover}` to the `<TilePalette>` child component.

**App.tsx** — Add tileset hover state and unify with map hover:
1. Add new state: `const [hoverSource, setHoverSource] = useState<'map' | 'tileset' | null>(null);`
2. In existing `handleCursorMove` callback: add `setHoverSource('map')` when setting valid cursor position, and `setHoverSource(null)` when clearing.
3. Add new callback:
   ```typescript
   const handleTilesetHover = useCallback((tileId: number | undefined, col: number, row: number) => {
     if (tileId !== undefined) {
       setCursorPos({ x: col, y: row });
       setCursorTileId(tileId);
       setHoverSource('tileset');
     } else {
       setCursorPos({ x: -1, y: -1 });
       setCursorTileId(undefined);
       setHoverSource(null);
     }
   }, []);
   ```
4. Pass `onTileHover={handleTilesetHover}` to `<TilesetPanel>` in the JSX.
5. Pass `hoverSource={hoverSource}` to `<StatusBar>` in the JSX.

**StatusBar.tsx** — Display source-aware coordinate labels:
1. Add `hoverSource` to Props interface: `hoverSource?: 'map' | 'tileset' | null`
2. Update coordinate display to show contextual labels:
   - When `hoverSource === 'map'`: show `X: {cursorX}  Y: {cursorY}` (existing behavior)
   - When `hoverSource === 'tileset'`: show `Col: {cursorX}  Row: {cursorY}` (tileset-specific labels)
   - When `hoverSource === null` or cursor outside: show `X: --  Y: --`
3. Tile ID display remains the same (`Tile: {cursorTileId}` or `Tile: --`).

**StatusBar.css** — Widen coords field to accommodate "Col: XX  Row: YY":
1. Increase `.status-field-coords` `min-width` from `100px` to `120px` to fit wider "Col:" label.
  </action>
  <verify>
Run `npm run typecheck` — zero TypeScript errors. Visually: hover over map canvas and see "X: 5  Y: 10  Tile: 280" in status bar. Hover over tileset panel and see "Col: 3  Row: 7  Tile: 283" in status bar. Move cursor away from both — status bar shows "X: --  Y: --  Tile: --".
  </verify>
  <done>
Status bar shows tile ID and coordinates from both map canvas (X/Y labels) and tileset panel (Col/Row labels). Coordinates and tile ID clear to "--" when cursor leaves both areas. No TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Make Map Settings dialog tabs responsive-scrollable</name>
  <files>
    src/components/MapSettingsDialog/MapSettingsDialog.css
  </files>
  <action>
The current `.tab-content` has `max-height: 420px` which is a fixed value. When the dialog's `max-height: 80vh` constrains the dialog at small window heights (e.g., 720px viewport = 576px dialog max), the content area may overflow the dialog bounds because the tab-content max-height doesn't adapt.

Fix by making `.tab-content` height responsive:
1. Remove the fixed `max-height: 420px` from `.tab-content`.
2. Change `.dialog-content` to use flex layout with `overflow: hidden` and `flex: 1; min-height: 0` to properly constrain children.
3. The `.tab-content` already has `flex: 1` and `overflow-y: auto` — once the parent constrains height via flex, it will scroll naturally.

Specific CSS changes:

In `.map-settings-dialog`:
- Add `display: flex; flex-direction: column;` so the dialog itself is a flex container.
- The `max-height: 80vh` already constrains the outer bounds.

In `.dialog-content`:
- Add `flex: 1; min-height: 0; overflow: hidden;` — this lets the content area shrink when the dialog is constrained. `min-height: 0` overrides the default flex min-height (which is min-content) to allow shrinking.

In `.tab-content`:
- Remove `max-height: 420px` — the flex parent now constrains height.
- Keep `flex: 1`, `overflow-y: auto`, `min-height: 300px` → but change `min-height` to `min-height: 0` so it can shrink freely. The `min-height: 300px` was preventing the flex item from shrinking below 300px, defeating scrolling at small sizes.

Result: At large windows, tab content fills available space naturally. At small windows (720p or below), the tab content area shrinks and shows a scrollbar.
  </action>
  <verify>
Run `npm run typecheck` — zero TypeScript errors. Resize the Electron window to ~720px height, open Map Settings dialog. All tabs (especially General which has the most content) should show a vertical scrollbar allowing access to all settings. At normal window sizes (1080p), dialog should look the same as before with no unnecessary scrollbar.
  </verify>
  <done>
Map Settings dialog tab content is fully scrollable at any window size. The General tab (longest content) shows a scrollbar when the window is small. No content is cut off.
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with zero errors
2. Hover over map canvas → status bar shows "X: N  Y: N" and "Tile: N" with correct values
3. Hover over tileset panel → status bar shows "Col: N  Row: N" and "Tile: N" with correct values
4. Move cursor away → status bar shows "X: --  Y: --" and "Tile: --"
5. Open Map Settings at 720p window size → General tab scrolls, all settings accessible
6. Open Map Settings at 1080p window size → dialog looks normal, no regression
</verification>

<success_criteria>
- STAT-01: Status bar shows tile ID and map coordinates when hovering over map canvas
- STAT-02: Status bar shows tile ID and tileset coordinates when hovering over tileset panel
- UI-01: Map Settings dialog tabs have working scrollbars at all window sizes
- Zero TypeScript errors (maintains Phase 32 baseline)
</success_criteria>

<output>
After completion, create `.planning/phases/36-status-bar-ui-polish/36-01-SUMMARY.md`
</output>
