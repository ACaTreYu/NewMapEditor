---
phase: 31-ui-completion-sedit-parity
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/core/map/types.ts
  - src/core/map/GameSettings.ts
  - src/core/map/MapParser.ts
autonomous: true

must_haves:
  truths:
    - "New maps created via createDefaultHeader() use SEdit-matching defaults (laserDamage=2, specialDamage=2, rechargeRate=2, holdingTime=15, maxSimulPowerups=12, name='New Map', description='New map')"
    - "SETTING_CATEGORIES consolidates 10 tabs into 5 groups (General, Weapons, Game Rules, Flagger, Advanced)"
    - "MapParser.ts documents the SEdit 'missles' typo for binary format clarity"
  artifacts:
    - path: "src/core/map/types.ts"
      provides: "Corrected default header values matching SEdit"
      contains: "laserDamage: 2"
    - path: "src/core/map/GameSettings.ts"
      provides: "Consolidated 5-tab category system with subcategory metadata"
      contains: "SETTING_SUBCATEGORIES"
    - path: "src/core/map/MapParser.ts"
      provides: "Binary format documentation for missles typo"
      contains: "misslesEnabled"
  key_links:
    - from: "src/core/map/types.ts"
      to: "src/core/map/MapParser.ts"
      via: "createDefaultHeader() used by parseV1()"
      pattern: "createDefaultHeader"
    - from: "src/core/map/GameSettings.ts"
      to: "src/components/MapSettingsDialog/MapSettingsDialog.tsx"
      via: "SETTING_CATEGORIES consumed by dialog tabs"
      pattern: "SETTING_CATEGORIES"
---

<objective>
Fix all 6 SEdit default value mismatches, consolidate SETTING_CATEGORIES from 10 tabs to 5 groups, and document the binary format "missles" typo in MapParser.ts.

Purpose: Achieve exact SEdit format parity at the data layer (PARITY-01, PARITY-02, PARITY-03) and prepare the category structure for UI consolidation.
Output: Corrected defaults in types.ts, 5-group SETTING_CATEGORIES with subcategory metadata in GameSettings.ts, documented binary format in MapParser.ts.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/core/map/types.ts
@src/core/map/GameSettings.ts
@src/core/map/MapParser.ts
@.planning/phases/31-ui-completion-sedit-parity/31-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix SEdit default values and consolidate tab categories</name>
  <files>src/core/map/types.ts, src/core/map/GameSettings.ts</files>
  <action>
**In `src/core/map/types.ts` — Fix 6 defaults in `createDefaultHeader()`:**

Update these fields to match SEdit's CreateNewMap() (map.cpp:2774-2848):
- `laserDamage: 1` → `laserDamage: 2`
- `specialDamage: 1` → `specialDamage: 2`
- `rechargeRate: 1` → `rechargeRate: 2`
- `holdingTime: 0` → `holdingTime: 15`
- `maxSimulPowerups: 0` → `maxSimulPowerups: 12`
- `name: 'Untitled'` → `name: 'New Map'`
- `description: ''` → `description: 'New map'`

Add inline comments showing SEdit source reference for each changed field (e.g., `// SEdit: map.cpp:2794`).

**In `src/core/map/GameSettings.ts` — Consolidate SETTING_CATEGORIES:**

Replace the 10-entry `SETTING_CATEGORIES` array with 5 entries:
```typescript
export const SETTING_CATEGORIES = [
  'General',     // Map info + header fields + general settings
  'Weapons',     // Laser, Missile, Bouncy, Grenade
  'Game Rules',  // HoldingTime, ElectionTime, SwitchWin, DominationWin + Toggles
  'Flagger',     // All F-prefixed variants
  'Advanced',    // DHT settings
] as const;
```

Remove the 'Map' category entirely (name/author are handled separately in the dialog).

Add subcategory metadata for tabs with internal groupings:
```typescript
export const SETTING_SUBCATEGORIES: Record<string, string[]> = {
  'Weapons': ['Laser', 'Missile', 'Bouncy', 'Grenade'],
  'Game Rules': ['Game', 'Toggles'],
  'Advanced': ['DHT']
};
```

Update the `category` field of each setting in `GAME_SETTINGS` array to match the new consolidated categories:
- Settings currently in 'General' category → keep as 'General'
- Settings in 'Laser', 'Missile', 'Bouncy', 'Grenade' → change to 'Weapons' and add a `subcategory` field
- Settings in 'Game' → change to 'Game Rules'
- Settings in 'DHT' → change to 'Advanced'
- Settings in 'Toggles' → change to 'Game Rules' and set subcategory to 'Toggles'
- Settings in 'Flagger' → keep as 'Flagger'

Add optional `subcategory` field to the `GameSetting` interface:
```typescript
export interface GameSetting {
  key: string;
  label: string;
  min: number;
  max: number;
  default: number;
  category: string;
  subcategory?: string;  // For visual grouping within a tab
  description?: string;
}
```

Also add a helper to get settings by subcategory:
```typescript
export function getSettingsBySubcategory(category: string, subcategory: string): GameSetting[] {
  return GAME_SETTINGS.filter(s => s.category === category && s.subcategory === subcategory);
}
```

Log a console summary at module level of changed defaults:
```typescript
// Default value corrections (SEdit parity):
// - laserDamage: 1→2, specialDamage: 1→2, rechargeRate: 1→2
// - holdingTime: 0→15, maxSimulPowerups: 0→12
// - name: 'Untitled'→'New Map', description: ''→'New map'
```
(This is a comment, not runtime console.log — keep it as documentation.)
  </action>
  <verify>Run `npm run typecheck` to confirm no TypeScript errors from the category/interface changes. Grep for `laserDamage: 2` in types.ts to confirm fix. Grep for `SETTING_SUBCATEGORIES` in GameSettings.ts to confirm export.</verify>
  <done>createDefaultHeader() returns SEdit-matching defaults for all 6 corrected fields. SETTING_CATEGORIES has exactly 5 entries. All 53 GAME_SETTINGS have correct category assignments. GameSetting interface includes optional subcategory field.</done>
</task>

<task type="auto">
  <name>Task 2: Document binary format compatibility in MapParser.ts</name>
  <files>src/core/map/MapParser.ts</files>
  <action>
Add a block comment at the top of MapParser.ts (below the existing module doc comment) documenting the SEdit binary format compatibility:

```typescript
/**
 * Binary Format Compatibility Notes:
 *
 * SEdit source code (main.h:90) uses "misslesEnabled" (misspelled) for the
 * boolean field at offset 0x10. Our TypeScript types use the correct spelling
 * "missilesEnabled". The binary I/O at offset 0x10 reads/writes this field
 * correctly — no spelling issue in binary data, only in SEdit's C++ struct.
 *
 * Default values written by this editor match SEdit's CreateNewMap() exactly
 * (map.cpp:2774-2848). Version is always written as V3_CURRENT.
 *
 * String encoding: UTF-8 (TextEncoder/TextDecoder). SEdit used system ANSI
 * code page, but UTF-8 is backwards-compatible for ASCII range (0x00-0x7F).
 */
```

Add inline comments at the serialize() offset 0x10 line where missilesEnabled is written:
- On the `view.setUint8(offset, header.missilesEnabled ? 1 : 0)` line, add: `// offset 0x10: "misslesEnabled" in SEdit (typo preserved in binary format)`

Add similar inline comment in parseV3() at the missilesEnabled read line:
- On the `const missilesEnabled = data.getUint8(offset) !== 0` line, add: `// offset 0x10: "misslesEnabled" in SEdit`
  </action>
  <verify>Grep for "misslesEnabled" in MapParser.ts to confirm documentation exists. Verify file still compiles with `npm run typecheck`.</verify>
  <done>MapParser.ts has block comment documenting SEdit binary format compatibility (missles typo, default values, string encoding, version strategy). Inline comments at offset 0x10 in both parseV3() and serialize().</done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with zero errors related to changed files
2. `createDefaultHeader()` returns laserDamage=2, specialDamage=2, rechargeRate=2, holdingTime=15, maxSimulPowerups=12, name='New Map', description='New map'
3. SETTING_CATEGORIES has exactly 5 entries: General, Weapons, Game Rules, Flagger, Advanced
4. All 53 GAME_SETTINGS entries have valid category values matching the 5 categories
5. MapParser.ts contains "misslesEnabled" documentation comment
6. GameSetting interface includes optional `subcategory` field
7. SETTING_SUBCATEGORIES export exists with Weapons, Game Rules, and Advanced entries
</verification>

<success_criteria>
- SEdit default values match exactly (6 fields corrected)
- Tab categories consolidated from 10 to 5 with subcategory metadata
- Binary format compatibility documented with SEdit typo reference
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/31-ui-completion-sedit-parity/31-01-SUMMARY.md`
</output>
