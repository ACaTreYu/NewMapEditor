---
phase: 61-layout-restructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/TilesetPanel/TilesetPanel.tsx
  - src/components/TilesetPanel/TilesetPanel.css
autonomous: true

must_haves:
  truths:
    - "Tile palette panel width is constrained to 640px"
    - "Tile palette no longer stretches to fill full bottom panel width"
    - "Freed horizontal space appears to the right of tile palette"
    - "Freed space collapses to zero width at narrow window sizes (< 640px)"
    - "Existing tile selection behavior works unchanged"
    - "Bottom panel vertical resize affects both sections equally"
  artifacts:
    - path: "src/components/TilesetPanel/TilesetPanel.tsx"
      provides: "Horizontal flex wrapper with two sections"
      contains: "tileset-palette-section"
    - path: "src/components/TilesetPanel/TilesetPanel.tsx"
      provides: "Freed space section"
      contains: "tileset-freed-section"
    - path: "src/components/TilesetPanel/TilesetPanel.css"
      provides: "Flexbox row layout styles"
      contains: "flex-direction: row"
    - path: "src/components/TilesetPanel/TilesetPanel.css"
      provides: "Fixed 640px tile palette section"
      contains: "flex: 0 0 640px"
    - path: "src/components/TilesetPanel/TilesetPanel.css"
      provides: "Flexible freed space section"
      contains: "flex: 1"
  key_links:
    - from: "src/components/TilesetPanel/TilesetPanel.tsx"
      to: ".tileset-palette-section"
      via: "className assignment"
      pattern: "tileset-palette-section"
    - from: "src/components/TilesetPanel/TilesetPanel.css"
      to: ".tileset-palette-section"
      via: "flex: 0 0 640px constraint"
      pattern: "flex:\\s*0\\s*0\\s*640px"
    - from: "src/components/TilesetPanel/TilesetPanel.css"
      to: ".tileset-freed-section"
      via: "min-width: 0 for collapse behavior"
      pattern: "min-width:\\s*0"
---

<objective>
Constrain tile palette to tileset width (640px) and free horizontal space to the right for Phase 62 ruler notepad panel.

Purpose: Restructure bottom panel layout so tile palette no longer stretches to full app width. Freed horizontal space will host ruler notepad in Phase 62.
Output: TilesetPanel with horizontal flex split - fixed 640px tile palette on left, flexible empty space on right.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/61-layout-restructure/61-CONTEXT.md
@.planning/phases/61-layout-restructure/61-RESEARCH.md
@src/components/TilesetPanel/TilesetPanel.tsx
@src/components/TilesetPanel/TilesetPanel.css
@src/components/TilePalette/TilePalette.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add horizontal split wrapper to TilesetPanel component</name>
  <files>src/components/TilesetPanel/TilesetPanel.tsx</files>
  <action>
Modify TilesetPanel.tsx to add horizontal flex split within tileset-panel-body:

1. Wrap TilePalette in a new div with className="tileset-palette-section"
2. Add sibling div with className="tileset-freed-section" (empty for now, Phase 62 will fill)
3. Keep existing panel-title-bar unchanged
4. Keep TilePalette component and its props unchanged (compact, fullHeight, onTileHover)

Structure:
```tsx
<div className="tileset-panel-body">
  {/* Left: Fixed 640px tile palette */}
  <div className="tileset-palette-section">
    <TilePalette tilesetImage={tilesetImage} compact fullHeight onTileHover={onTileHover} />
  </div>

  {/* Right: Freed space for Phase 62 */}
  <div className="tileset-freed-section">
    {/* Empty - no content needed */}
  </div>
</div>
```

Do NOT modify TilePalette component - it already uses ResizeObserver which will automatically detect the 640px constraint from parent wrapper.
  </action>
  <verify>
1. Read modified TilesetPanel.tsx and confirm two sibling divs exist in tileset-panel-body
2. Confirm TilePalette component and props are unchanged
3. Run `npm run typecheck` to verify TypeScript compiles
  </verify>
  <done>
TilesetPanel.tsx has horizontal split structure with tileset-palette-section and tileset-freed-section divs, TilePalette component unchanged, TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Update TilesetPanel CSS with flexbox row layout</name>
  <files>src/components/TilesetPanel/TilesetPanel.css</files>
  <action>
Modify TilesetPanel.css to implement horizontal flex layout:

1. Change .tileset-panel-body to horizontal flex container:
   - Add `display: flex;`
   - Add `flex-direction: row;`
   - Change `overflow-y: auto;` to `overflow: hidden;`

2. Add .tileset-palette-section class:
   - `flex: 0 0 640px;` (fixed width, no grow, no shrink)
   - `overflow-x: auto;` (horizontal scroll if window < 640px)
   - `overflow-y: hidden;` (TilePalette handles vertical scroll internally)
   - `border-right: 1px solid var(--border-default);` (separator)

3. Add .tileset-freed-section class:
   - `flex: 1;` (fills remaining space)
   - `min-width: 0;` (CRITICAL: allows collapse to zero width at narrow windows)
   - `background: var(--bg-secondary);` (subtle empty state)
   - `overflow: hidden;` (hide overflow)

Per user decision: 640px is content area only (borders/padding are additional), divider is not resizable, freed space collapses to zero at narrow widths.

Per research: `min-width: 0` is critical to allow flex item to shrink below content size (prevents unwanted scrollbars).
  </action>
  <verify>
1. Read modified TilesetPanel.css and confirm:
   - .tileset-panel-body has `display: flex; flex-direction: row;`
   - .tileset-palette-section has `flex: 0 0 640px;`
   - .tileset-freed-section has `flex: 1; min-width: 0;`
2. Run `npm run electron:dev` and visually confirm:
   - Tile palette is constrained to ~640px width (not full app width)
   - Freed space appears to the right with subtle background
   - At narrow window widths (< 640px), freed space collapses and horizontal scroll appears on palette section
   - Existing tile selection behavior works (click/drag to select tiles)
   - Bottom panel vertical resize affects both sections equally
  </verify>
  <done>
TilesetPanel.css has flexbox row layout, tile palette constrained to 640px, freed space fills remaining width with collapse behavior, visual verification confirms all requirements met
  </done>
</task>

</tasks>

<verification>
Run full verification checklist:

1. **Layout constraint verification:**
   - Tile palette panel width is exactly 640px (content area)
   - Borders/padding are additional to 640px content area
   - Tile palette does not stretch to full app width

2. **Freed space verification:**
   - Freed horizontal space appears to right of tile palette
   - Freed space has subtle background (var(--bg-secondary))
   - 1px border separates palette and freed space

3. **Responsive behavior verification:**
   - At window width > 640px: both sections visible, no horizontal scroll
   - At window width < 640px: freed space collapses to zero width, horizontal scroll appears on palette section only
   - Bottom panel vertical resize affects both sections equally (unified height)

4. **Existing functionality verification:**
   - Tile selection works (click single tile, drag to select multiple)
   - Tile palette vertical scroll works (scroll through tile rows)
   - TilePalette component unchanged (verify no regressions)
   - Panel resize handle works (drag to resize bottom panel height)

5. **Visual polish verification:**
   - Layout matches existing panel design
   - Divider border matches other panel borders (var(--border-default))
   - Empty state is subtle and non-distracting
</verification>

<success_criteria>
**What must be TRUE for this plan to be complete:**

1. Tile palette panel width is constrained to 640px (visible in dev tools)
2. Tile palette no longer stretches to full bottom panel width at wide window sizes
3. Freed horizontal space appears to the right of tile palette with subtle background
4. Freed space collapses to zero width when window < 640px (palette shows horizontal scroll)
5. Existing tile selection behavior works unchanged (click/drag in palette)
6. Bottom panel vertical resize affects both sections equally (both have same height)
7. Layout change does not break existing panel resize behavior
8. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/61-layout-restructure/61-01-SUMMARY.md`
</output>
