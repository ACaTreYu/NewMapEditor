---
phase: 78-cleanup-code-quality
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/variables.css
  - src/components/Workspace/Workspace.css
  - src/components/MapSettingsDialog/MapSettingsDialog.css
  - src/components/TilePalette/TilePalette.css
autonomous: true

must_haves:
  truths:
    - "Title bar gradient uses CSS variable instead of hardcoded #000080 and #1084d0"
    - "Close button red (#dc3545) replaced with --color-error token in all 3 occurrences"
    - "Checkerboard pattern uses --color-neutral-300 instead of hardcoded #cccccc"
    - "Window box-shadow uses --shadow-* tokens instead of inline rgba()"
    - "Hover overlay uses --surface-hover-overlay token instead of inline rgba(255,255,255,0.2)"
    - "--color-error token is defined in variables.css following OKLCH two-tier pattern"
  artifacts:
    - path: "src/styles/variables.css"
      provides: "New design tokens: --color-red-500, --color-error, --gradient-title-bar, --surface-hover-overlay"
      contains: "--color-error"
    - path: "src/components/Workspace/Workspace.css"
      provides: "All hardcoded hex/rgba replaced with design tokens"
    - path: "src/components/MapSettingsDialog/MapSettingsDialog.css"
      provides: "Title bar gradient uses --gradient-title-bar token"
    - path: "src/components/TilePalette/TilePalette.css"
      provides: "Checkerboard uses --color-neutral-300 and --surface tokens"
  key_links:
    - from: "src/components/Workspace/Workspace.css"
      to: "src/styles/variables.css"
      via: "var() references"
      pattern: "var\\(--color-error\\)"
    - from: "src/components/MapSettingsDialog/MapSettingsDialog.css"
      to: "src/styles/variables.css"
      via: "var() references"
      pattern: "var\\(--gradient-title-bar\\)"
---

<objective>
Replace all hardcoded hex and rgba CSS values with design tokens from the existing two-tier OKLCH system. Add 3 new tokens (--color-error, --gradient-title-bar, --surface-hover-overlay) and migrate ~15 hardcoded values across 4 CSS files.

Purpose: Enforce design token consistency — all visual values should flow from variables.css so theme changes propagate automatically.
Output: Zero hardcoded color/shadow values in component CSS files (except variables.css definitions and intentional exceptions).
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/78-cleanup-code-quality/78-RESEARCH.md
@src/styles/variables.css
@src/components/Workspace/Workspace.css
@src/components/MapSettingsDialog/MapSettingsDialog.css
@src/components/TilePalette/TilePalette.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define new design tokens in variables.css</name>
  <files>src/styles/variables.css</files>
  <action>
Add 3 new design tokens to variables.css, following the existing two-tier OKLCH pattern.

**1. Error/danger red (Tier 1 primitive + Tier 2 semantic):**
Add after the existing `--color-blue-600` line (around line 31), in the Tier 1 Color Primitives section:

```css
/* Red palette */
--color-red-500: oklch(55% 0.22 25);           /* Error/danger red (~#dc3545) */
```

Then in the Tier 2 Semantic Aliases section, add after `--text-warning` (around line 178):

```css
/* Error/danger */
--color-error: var(--color-red-500);
```

**2. Title bar gradient (Tier 2 semantic — composite value):**
Add in the Tier 2 section after the new --color-error line:

```css
/* Title bar */
--gradient-title-bar: linear-gradient(to right, oklch(28% 0.15 265), var(--accent-primary));
```

Note: oklch(28% 0.15 265) is the OKLCH equivalent of #000080 (navy blue). The light end uses the existing --accent-primary token which maps to --color-blue-500.

**3. Surface hover overlay (Tier 2 semantic):**
Add in the Tier 2 section near the existing --overlay-bg:

```css
/* Button hover overlay (on colored backgrounds) */
--surface-hover-overlay: rgba(255, 255, 255, 0.2);
```

**Also migrate existing hardcoded values in variables.css:**
- Replace `--text-warning: #cc4400;` with proper OKLCH:
  Add `--color-orange-600: oklch(55% 0.17 50);` to Tier 1, then change `--text-warning` to `var(--color-orange-600)`.
- Leave `--text-on-accent: #ffffff;` as-is (white is a special case, already semantic).
  </action>
  <verify>
- `grep "--color-error" src/styles/variables.css` returns the token definition
- `grep "--gradient-title-bar" src/styles/variables.css` returns the token definition
- `grep "--surface-hover-overlay" src/styles/variables.css` returns the token definition
- `grep "--color-red-500" src/styles/variables.css` returns the OKLCH primitive
- No raw hex values in variables.css except #ffffff for --text-on-accent (acceptable)
  </verify>
  <done>Three new design tokens defined in variables.css following OKLCH two-tier pattern. --text-warning also migrated to OKLCH.</done>
</task>

<task type="auto">
  <name>Task 2: Replace hardcoded values in component CSS files</name>
  <files>
    src/components/Workspace/Workspace.css
    src/components/MapSettingsDialog/MapSettingsDialog.css
    src/components/TilePalette/TilePalette.css
  </files>
  <action>
Replace all hardcoded hex/rgba values with design tokens. Work through each file systematically:

**Workspace.css — 8 replacements:**

1. Line 36: `box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);`
   → `box-shadow: var(--shadow-sm);`

2. Line 41: `box-shadow: 0 2px 12px rgba(0, 0, 0, 0.25);`
   → `box-shadow: var(--shadow-md);`

3. Line 167: `background: #dc3545;`
   → `background: var(--color-error);`

4. Line 172: `background: #dc3545;`
   → `background: var(--color-error);`

5. Line 180: `background: rgba(255, 255, 255, 0.2);`
   → `background: var(--surface-hover-overlay);`

6. Line 232: `box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);`
   → `box-shadow: var(--shadow-xs);`

7. Line 262: `background: #dc3545;`
   → `background: var(--color-error);`

8. Line 267: `background: rgba(255, 255, 255, 0.2);`
   → `background: var(--surface-hover-overlay);`

**MapSettingsDialog.css — 2 replacements:**

1. Line 30: `background: linear-gradient(to right, #000080, #1084d0);`
   → `background: var(--gradient-title-bar);`

2. Line 65: `background: rgba(255, 255, 255, 0.2);`
   → `background: var(--surface-hover-overlay);`

**TilePalette.css — 5 replacements:**

1. Line 38: `background-color: #ffffff;`
   → `background-color: var(--surface);`

2-5. Lines 40-43: Replace all 4 instances of `#cccccc` with `var(--color-neutral-300)`:
   ```css
   background-image:
     linear-gradient(45deg, var(--color-neutral-300) 25%, transparent 25%),
     linear-gradient(-45deg, var(--color-neutral-300) 25%, transparent 25%),
     linear-gradient(45deg, transparent 75%, var(--color-neutral-300) 75%),
     linear-gradient(-45deg, transparent 75%, var(--color-neutral-300) 75%);
   ```

**Files NOT modified (intentional exceptions):**
- MapCanvas.css line 14: `#932bcf` — This is the out-of-bounds canvas background (debug purple), intentionally distinctive. Not a design token candidate.
- AnimationPanel.css lines 139-140: Already use `var(--color-error, #e53935)` fallback pattern. Once --color-error is defined in variables.css, the fallbacks become inert. No change needed.
- RulerNotepadPanel.css and TilesetPanel.css: Already use `var(--surface-hover, rgba(...))` fallback patterns. No change needed.
- MapSettingsDialog.css line 142: Already uses `var(--surface-light, #c0c0c0)` fallback. No change needed.

**Requirement CODE-01 (duplicate centering math):**
Research grep found zero instances of duplicate viewport centering math in the codebase. This requirement appears to be premature or based on outdated information. Mark CODE-01 as N/A in requirements traceability — no action taken.
  </action>
  <verify>
- `grep -n "#dc3545" src/components/Workspace/Workspace.css` returns zero matches
- `grep -n "#000080\|#1084d0" src/components/MapSettingsDialog/MapSettingsDialog.css` returns zero matches
- `grep -n "#cccccc" src/components/TilePalette/TilePalette.css` returns zero matches
- `grep -c "rgba(" src/components/Workspace/Workspace.css` returns 0 (no inline rgba left)
- Application builds without CSS errors: `npm run electron:dev` starts correctly
- Visual check: title bar gradient, close button red, checkerboard pattern all look correct
  </verify>
  <done>All 15 hardcoded hex/rgba values replaced with design tokens across 3 component CSS files. No hardcoded color values remain in component CSS (except intentional exceptions documented above). CODE-01 marked N/A — no duplicate centering math found.</done>
</task>

</tasks>

<verification>
1. `grep -rn "#dc3545\|#000080\|#1084d0\|#cccccc" src/components/` returns zero matches
2. `grep -c "rgba(" src/components/Workspace/Workspace.css` returns 0
3. `grep "--color-error" src/styles/variables.css` confirms token exists
4. `grep "--gradient-title-bar" src/styles/variables.css` confirms token exists
5. Application builds and runs: `npm run electron:dev` starts without errors
6. Visual spot-check: Map Settings dialog title bar shows blue gradient, close buttons turn red on hover, checkerboard pattern visible in tile palette
</verification>

<success_criteria>
- All 3 new design tokens defined in variables.css (--color-error, --gradient-title-bar, --surface-hover-overlay)
- Zero hardcoded #dc3545 in component CSS files
- Zero hardcoded #000080 or #1084d0 in component CSS files
- Zero hardcoded #cccccc in component CSS files
- Window shadows use --shadow-* tokens
- Hover overlays use --surface-hover-overlay
- Application renders correctly with no visual regressions
- Requirements CSS-01, CSS-02, CSS-03 satisfied
- CODE-01 (duplicate centering math → shared utility): N/A — research phase grep found zero instances of duplicate viewport centering math in the codebase; no shared utility needed
</success_criteria>

<output>
After completion, create `.planning/phases/78-cleanup-code-quality/78-02-SUMMARY.md`
</output>
