---
phase: 12-theme-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useTheme.ts
  - src/components/ToolBar/Toolbar.tsx
  - src/components/MapSettingsPanel/MapSettingsPanel.tsx
  - index.html
autonomous: true

must_haves:
  truths:
    - "Theme toggle cycles through Win98 color schemes (Standard, High Contrast, Desert) instead of dark/light/system"
    - "FOUC prevention script in index.html applies Win98 scheme class instead of dark/light class"
    - "localStorage stores Win98 scheme name, not dark/light preference"
  artifacts:
    - path: "src/hooks/useTheme.ts"
      provides: "Win98 scheme switching hook"
      exports: ["useTheme", "Win98Scheme"]
    - path: "src/components/ToolBar/Toolbar.tsx"
      provides: "Theme toggle button cycling Win98 schemes"
      contains: "cycleTheme"
    - path: "index.html"
      provides: "FOUC prevention for Win98 schemes"
      contains: "theme-"
  key_links:
    - from: "src/hooks/useTheme.ts"
      to: "document.documentElement.classList"
      via: "applyTheme function"
      pattern: "classList\\.(add|remove)"
    - from: "src/components/ToolBar/Toolbar.tsx"
      to: "src/hooks/useTheme.ts"
      via: "useTheme import"
      pattern: "useTheme"
---

<objective>
Repurpose the existing dark/light theme toggle into a Win98 color scheme switcher that cycles through Standard, High Contrast, and Desert schemes.

Purpose: The theme toggle infrastructure already works — it persists to localStorage, applies CSS classes, and has UI in the toolbar. Instead of deleting it (THEME-02 says remove dark/light), we repurpose it to switch between Win98 color schemes, fulfilling both the "remove dark/light" requirement and the user's decision to keep a scheme switcher.

Output: Updated useTheme hook, Toolbar button, MapSettingsPanel references, and index.html FOUC prevention — all switching Win98 schemes instead of dark/light.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-theme-foundation/12-CONTEXT.md

Key existing files:
@src/hooks/useTheme.ts
@src/components/ToolBar/Toolbar.tsx
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Repurpose useTheme hook for Win98 color schemes</name>
  <files>
    src/hooks/useTheme.ts
    index.html
  </files>
  <action>
    1. Rewrite `src/hooks/useTheme.ts` to switch Win98 color schemes instead of dark/light:

       - Replace type `Theme = 'light' | 'dark' | 'system'` with `Win98Scheme = 'standard' | 'high-contrast' | 'desert'`
       - Remove `EffectiveTheme` type entirely (no "system" detection needed)
       - Remove `getSystemTheme()` function (no system preference detection)
       - Update `STORAGE_KEY` to `'win98-scheme'`
       - Update `getStoredTheme()` → `getStoredScheme()`: reads from localStorage, validates against scheme names, defaults to `'standard'`
       - Update `applyTheme()` → `applyScheme()`:
         - Remove old classes: `root.classList.remove('theme-high-contrast', 'theme-desert')`
         - For 'standard': don't add any class (default :root values apply)
         - For 'high-contrast': add `theme-high-contrast`
         - For 'desert': add `theme-desert`
       - Simplify the hook itself:
         - Single state: `const [scheme, setSchemeState] = useState<Win98Scheme>(getStoredScheme)`
         - useEffect to apply scheme class when state changes
         - useEffect to persist to localStorage when state changes
         - Remove system preference media query listener entirely
       - Export: `useTheme` (keep same name for minimal refactoring), `Win98Scheme` type
       - Return interface: `{ scheme: Win98Scheme, setScheme: (s: Win98Scheme) => void }`

    2. Update `index.html` FOUC prevention script:
       - Change localStorage key from `'theme'` to `'win98-scheme'`
       - Remove system preference detection (matchMedia)
       - Map stored scheme to CSS class:
         - 'standard' or missing → no class added (defaults work)
         - 'high-contrast' → add 'theme-high-contrast'
         - 'desert' → add 'theme-desert'
       - Remove the try/catch fallback that adds 'theme-dark'
  </action>
  <verify>
    - TypeScript compiles: run `npx tsc --noEmit --pretty` from project root (may have pre-existing errors — focus on useTheme.ts having no NEW errors)
    - Confirm useTheme.ts exports Win98Scheme type and useTheme function
    - Confirm no references to 'dark', 'light', or 'system' remain in useTheme.ts
    - Confirm index.html references 'win98-scheme' not 'theme'
  </verify>
  <done>useTheme hook manages Win98 color schemes (standard/high-contrast/desert) with localStorage persistence and FOUC prevention.</done>
</task>

<task type="auto">
  <name>Task 2: Update Toolbar and MapSettingsPanel theme toggle UI</name>
  <files>
    src/components/ToolBar/Toolbar.tsx
    src/components/MapSettingsPanel/MapSettingsPanel.tsx
  </files>
  <action>
    1. Update `src/components/ToolBar/Toolbar.tsx`:
       - Change import from `{ useTheme, Theme }` to `{ useTheme, Win98Scheme }`
       - Update `cycleTheme` to cycle through Win98 schemes:
         ```
         const order: Win98Scheme[] = ['standard', 'high-contrast', 'desert'];
         const current = order.indexOf(scheme);
         const next = (current + 1) % order.length;
         setScheme(order[next]);
         ```
       - Update destructuring from `const { theme, setTheme }` to `const { scheme, setScheme }`
       - Update `themeIcons` to scheme icons: `{ standard: 'W', 'high-contrast': 'H', desert: 'D' }`
       - Update `themeLabels` to scheme labels: `{ standard: 'Win98', 'high-contrast': 'Hi-Con', desert: 'Desert' }`
       - Update button title to `Theme: ${schemeLabels[scheme]} (click to cycle)`
       - Update toolbar-label text to show scheme label

    2. Update `src/components/MapSettingsPanel/MapSettingsPanel.tsx`:
       - Check how useTheme is used here. It imports `{ useTheme, Theme }` and uses `const { theme, setTheme } = useTheme()`
       - Update import to `{ useTheme, Win98Scheme }`
       - Update destructuring to `const { scheme, setScheme } = useTheme()`
       - Update any references from `theme`/`setTheme` to `scheme`/`setScheme`
       - If the panel has a theme selector UI, update it to show Win98 scheme options instead of dark/light/system
  </action>
  <verify>
    - TypeScript compiles without new errors in Toolbar.tsx and MapSettingsPanel.tsx
    - Confirm no imports of old `Theme` type remain in either file
    - Confirm no references to 'dark', 'light', or 'system' in theme-related code in either file
  </verify>
  <done>Toolbar theme button cycles Win98 schemes with appropriate labels/icons. MapSettingsPanel updated to match new scheme API.</done>
</task>

</tasks>

<verification>
1. useTheme.ts exports Win98Scheme and useTheme with scheme-based API
2. No references to 'dark'/'light'/'system' theme modes in modified files
3. index.html FOUC script uses 'win98-scheme' localStorage key
4. Toolbar button cycles: Standard → High Contrast → Desert → Standard
5. TypeScript compiles for all modified files
</verification>

<success_criteria>
- Dark/light theme toggle is fully replaced with Win98 scheme switcher
- Three schemes available: Standard, High Contrast, Desert
- Theme persists to localStorage across sessions
- FOUC prevention applies correct scheme class before paint
</success_criteria>

<output>
After completion, create `.planning/phases/12-theme-foundation/12-02-SUMMARY.md`
</output>
