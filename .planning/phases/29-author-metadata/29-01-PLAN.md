---
phase: 29-author-metadata
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/MapSettingsDialog/MapSettingsDialog.tsx
autonomous: true

must_haves:
  truths:
    - "User can enter author name in a dedicated text field in Map Settings dialog"
    - "Author name persists to map file on save (serialized to description as 'Author=name')"
    - "Author name populates from description field when opening Map Settings on a loaded map"
    - "Empty author name does not produce 'Author=' in description"
    - "Editing author field enables Apply button (dirty flag)"
  artifacts:
    - path: "src/components/MapSettingsDialog/MapSettingsDialog.tsx"
      provides: "Author text input, parseAuthor/serializeAuthor helpers, dirty tracking"
      contains: "parseAuthor"
  key_links:
    - from: "MapSettingsDialog open()"
      to: "parseAuthor()"
      via: "Extracts author from map.header.description on dialog open"
      pattern: "parseAuthor\\(map\\.header\\.description\\)"
    - from: "handleApply()"
      to: "serializeAuthor()"
      via: "Prepends Author=name to description before saving"
      pattern: "serializeAuthor\\(mapDescription.*mapAuthor\\)"
---

<objective>
Add author metadata support to the Map Settings dialog.

Purpose: Users can attribute maps with their author name. The author is stored in the description field using "Author=name" format, preparing the groundwork for Phase 30's comprehensive settings serialization.
Output: MapSettingsDialog with author text input, parse/serialize helpers, full dirty tracking integration.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/MapSettingsDialog/MapSettingsDialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add parseAuthor and serializeAuthor helpers</name>
  <files>src/components/MapSettingsDialog/MapSettingsDialog.tsx</files>
  <action>
Add two helper functions ABOVE the component definition in MapSettingsDialog.tsx:

1. `parseAuthor(description: string): string`
   - Use regex `/Author=([^,]*)/` to match "Author=value" anywhere in the description string
   - Return `match[1].trim()` if found, empty string if not
   - Must handle: no Author field, Author at start, Author in middle, Author at end

2. `serializeAuthor(description: string, author: string): string`
   - First, remove any existing "Author=..." entry from description:
     `description.replace(/Author=[^,]*(,\s*)?/, '')` then `.replace(/(,\s*)?$/, '').trim()` to clean trailing comma/space
   - If `author.trim()` is non-empty, prepend `Author=${author.trim()}` to the cleaned description
     - If cleaned description is non-empty: `Author=${author.trim()}, ${cleanedDescription}`
     - If cleaned description is empty: `Author=${author.trim()}`
   - If author is empty, just return the cleaned description
   - Must not leave orphan commas or trailing whitespace

These are module-level functions (not inside the component) for potential reuse in Phase 30.
  </action>
  <verify>
Read the file and confirm both functions exist above the component, have correct TypeScript signatures, and handle edge cases (empty author, author with spaces, existing Author= entry in description).
  </verify>
  <done>parseAuthor extracts author from description string; serializeAuthor inserts/removes author in description string; both handle edge cases cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Add author field to Map Settings dialog with full state integration</name>
  <files>src/components/MapSettingsDialog/MapSettingsDialog.tsx</files>
  <action>
Make these changes to MapSettingsDialog.tsx:

1. **Add state** (after the existing `mapDescription` useState on line 16):
   ```typescript
   const [mapAuthor, setMapAuthor] = useState('');
   ```

2. **Add dirty wrapper** (after `setMapDescriptionWithDirty` around line 91):
   ```typescript
   const setMapAuthorWithDirty = (author: string) => {
     setMapAuthor(author);
     setIsDirty(true);
   };
   ```

3. **Parse author on open** (inside the `useImperativeHandle` open callback, after `setMapDescription(map.header.description)` on line 26):
   ```typescript
   setMapAuthor(parseAuthor(map.header.description));
   ```

4. **Serialize author on Apply** (modify `handleApply` around line 46):
   Replace `description: mapDescription` with:
   ```typescript
   description: serializeAuthor(mapDescription, mapAuthor)
   ```

5. **Add Author input to Map tab JSX** (between the Map Name `setting-group` div and the Description `setting-group` div, around line 128-129):
   ```tsx
   <div className="setting-group">
     <label className="setting-label">Author</label>
     <input
       type="text"
       value={mapAuthor}
       onChange={(e) => setMapAuthorWithDirty(e.target.value)}
       className="text-input"
       maxLength={32}
     />
   </div>
   ```

The Author field appears between Map Name and Description in the Map tab. It uses the same `.text-input` CSS class and `maxLength={32}` as the Map Name field. No CSS changes needed.
  </action>
  <verify>
1. Run `npm run typecheck` to confirm no TypeScript errors.
2. Read the file and verify:
   - `mapAuthor` state is declared
   - `setMapAuthorWithDirty` exists
   - `parseAuthor` is called in `open()`
   - `serializeAuthor` is called in `handleApply()`
   - Author input JSX is between Map Name and Description in the Map tab
   - Author input has `maxLength={32}` and uses `text-input` class
  </verify>
  <done>Author text field appears in Map Settings dialog Map tab between name and description. Editing author enables Apply button. Apply serializes author into description field. Opening dialog on existing map parses author from description.</done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with zero errors related to MapSettingsDialog
2. MapSettingsDialog.tsx contains:
   - `parseAuthor` function that extracts author from description
   - `serializeAuthor` function that inserts/removes author in description
   - `mapAuthor` state variable
   - Author input field in Map tab between name and description
   - `parseAuthor` called in `open()` callback
   - `serializeAuthor` called in `handleApply()`
3. Edge cases handled:
   - Empty author does not produce "Author=" in description
   - Author with leading/trailing spaces is trimmed
   - Existing "Author=oldname" is replaced when saving new author
</verification>

<success_criteria>
- User can type an author name in a dedicated field in the Map Settings dialog (META-01)
- Author name serializes to description field as "Author=name" on Apply (META-02)
- Author name parses from description field and displays when dialog opens (META-03)
- Dirty flag triggers correctly for author field changes
- No orphan commas or whitespace in description field after serialization
</success_criteria>

<output>
After completion, create `.planning/phases/29-author-metadata/29-01-SUMMARY.md`
</output>
