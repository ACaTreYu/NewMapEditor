---
phase: 57-selection-info-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/StatusBar/StatusBar.tsx
  - src/components/MapCanvas/MapCanvas.tsx
autonomous: true

must_haves:
  truths:
    - "Status bar shows selection dimensions and tile count in format 'Sel: 5x3 (15 tiles)'"
    - "Floating dimension label appears outside selection border when multi-tile selection exists"
    - "Label repositions intelligently when selection is near viewport left or top edge"
    - "Label text is readable at all zoom levels (0.25x-4x) using fixed 13px font size"
    - "Single tile (1x1) selection shows neither status bar info nor floating label"
  artifacts:
    - path: "src/components/StatusBar/StatusBar.tsx"
      provides: "Enhanced selection info with tile count"
      contains: "tileCount"
    - path: "src/components/MapCanvas/MapCanvas.tsx"
      provides: "Floating dimension label on canvas UI layer"
      contains: "labelText"
  key_links:
    - from: "src/components/StatusBar/StatusBar.tsx"
      to: "tileSelection (Zustand)"
      via: "useEditorStore selector"
      pattern: "tileSelection\\.width.*tileSelection\\.height"
    - from: "src/components/MapCanvas/MapCanvas.tsx"
      to: "activeSelection (drawUiLayer)"
      via: "selectionDragRef or selection state"
      pattern: "activeSelection.*labelText"
---

<objective>
Add selection dimension and tile count display in two locations: enhanced status bar text and floating canvas label.

Purpose: Users can see selection dimensions and tile count without mental math, with contextual feedback during drag operations and a persistent status bar indicator.
Output: Updated StatusBar.tsx with tile count format, updated MapCanvas.tsx with floating label in drawUiLayer().
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/57-selection-info-enhancement/57-RESEARCH.md
@src/components/StatusBar/StatusBar.tsx
@src/components/MapCanvas/MapCanvas.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update status bar selection info and add floating canvas label</name>
  <files>
    src/components/StatusBar/StatusBar.tsx
    src/components/MapCanvas/MapCanvas.tsx
  </files>
  <action>
**StatusBar.tsx** (lines 32, 165-169):

1. After the existing `showSelection` check (line 32), compute tile count:
   ```typescript
   const tileCount = tileSelection.width * tileSelection.height;
   ```

2. Update the status bar selection field (lines 165-169) to show compact format with tile count:
   ```typescript
   {showSelection && (
     <div className="status-field">
       Sel: {tileSelection.width}x{tileSelection.height} ({tileCount} tiles)
     </div>
   )}
   ```
   Note: Remove the spaces around "x" (was "5 x 3", now "5x3") and append tile count in parentheses.

**MapCanvas.tsx** (drawUiLayer function, after selection rectangle rendering at ~line 572):

3. Add floating dimension label AFTER the selection rectangle rendering block (after the closing `}` of the `if (activeSelection)` block at line 572). Insert the label inside a NEW `if (activeSelection)` block (or extend the existing one before its closing brace). The label renders when any multi-tile selection exists (width > 1 OR height > 1).

   Implementation details:
   - Compute `w` and `h` from the existing `minX/maxX/minY/maxY` variables already computed in the activeSelection block (lines 555-560). Reuse those variables by placing the label code inside the existing `if (activeSelection)` block, before its closing brace.
   - Only show label when `w > 1 || h > 1` (skip 1x1 selections, consistent with status bar behavior).
   - Format: `${w}x${h} (${w * h})` (e.g., "5x3 (15)")
   - Font: `'13px sans-serif'` (fixed size, NOT scaled by zoom, matches line preview label pattern at line 313-316)
   - Text alignment: `ctx.textAlign = 'left'`, `ctx.textBaseline = 'bottom'`

   **Intelligent positioning logic:**
   - Default position: top-left corner of selection, offset above and to the left
     ```typescript
     const metrics = ctx.measureText(labelText);
     const textWidth = metrics.width;
     const textHeight = 18; // 13px font + padding
     const pad = 4;

     // Default: above-left of selection
     let labelX = selScreen.x;
     let labelY = selScreen.y - pad;
     ```
   - Fallback 1 (left edge clipped): If `labelX < 0`, move to right side of selection:
     ```typescript
     if (labelX < 0) {
       labelX = selScreen.x + w * tilePixels;
     }
     ```
   - Fallback 2 (top edge clipped): If `labelY - textHeight < 0`, move below selection:
     ```typescript
     if (labelY - textHeight < 0) {
       labelY = selScreen.y + h * tilePixels + textHeight + pad;
     }
     ```

   **Background rectangle for readability:**
   ```typescript
   ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
   ctx.fillRect(labelX - pad, labelY - textHeight, textWidth + pad * 2, textHeight);
   ```

   **Text rendering:**
   ```typescript
   ctx.fillStyle = '#ffffff';
   ctx.font = '13px sans-serif';
   ctx.textAlign = 'left';
   ctx.textBaseline = 'bottom';
   ctx.fillText(labelText, labelX, labelY);
   ```

   Important: The label must render AFTER the selection rectangle strokes so it appears on top. Place all label code inside the existing `if (activeSelection)` block, after the two `strokeRect` calls.
  </action>
  <verify>
    1. Run `npm run typecheck` — no type errors
    2. Run `npm run electron:dev` — app launches without errors
    3. Visual check: Select a 3x4 region on the map. Status bar should show "Sel: 3x4 (12 tiles)". A floating label "3x4 (12)" should appear above the selection with a dark background.
    4. Edge test: Select near top-left corner of viewport — label should reposition below or to the right.
    5. Single tile: Click a single tile — no selection info in status bar, no floating label.
    6. Zoom test: Zoom to 0.25x and 4x — label text stays readable (13px fixed).
  </verify>
  <done>
    - Status bar shows "Sel: WxH (N tiles)" for any multi-tile selection
    - Floating label shows "WxH (N)" positioned outside selection border on canvas
    - Label repositions when near viewport edges (left clipped -> right side, top clipped -> below)
    - Label readable at all zoom levels (0.25x-4x)
    - 1x1 selections show neither status bar info nor floating label
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with zero errors
2. Status bar format matches exactly: "Sel: 5x3 (15 tiles)" (no spaces around x, tile count in parens)
3. Floating label format: "5x3 (15)" with semi-transparent black background and white text
4. Label appears during selection drag (consistent with rect drag label behavior)
5. Label does NOT appear for 1x1 selections
6. Label repositions when selection is near viewport top or left edge
7. Text is 13px fixed size at all zoom levels
</verification>

<success_criteria>
- Status bar enhanced with tile count for multi-tile selections
- Floating canvas label with intelligent positioning renders on UI layer
- Both displays are consistent in showing dimensions for multi-tile selections only
- No performance regression (label renders within existing RAF-debounced drawUiLayer cycle)
</success_criteria>

<output>
After completion, create `.planning/phases/57-selection-info-enhancement/57-01-SUMMARY.md`
</output>
