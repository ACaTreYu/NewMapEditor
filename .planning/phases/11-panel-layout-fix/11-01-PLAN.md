---
phase: 11-panel-layout-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/App.css
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "Map canvas visually dominates the window (>60% of viewport)"
    - "Tileset panel shows multiple rows of tiles without scrolling on 1080p"
    - "Animation panel shows animation previews clearly (not cut off)"
    - "Dragging panel dividers resizes adjacent panels"
    - "Fresh app launch shows SEdit-like proportions"
  artifacts:
    - path: "src/App.css"
      provides: "Flexbox min-height override and resize handle CSS"
      contains: "[data-panel-id]"
    - path: "src/App.tsx"
      provides: "Panel layout with correct defaultSize proportions"
      contains: "defaultSize"
  key_links:
    - from: "src/App.css"
      to: "react-resizable-panels data attributes"
      via: "CSS selector targeting library internals"
      pattern: "\\[data-panel"
---

<objective>
Fix the panel layout so the map canvas dominates the window and dividers are draggable

Purpose: The canvas currently collapses to a thin strip due to flexbox's automatic minimum size behavior. Research identified the root cause (min-height: auto on flex items) and the fix (min-height: 0 on panel elements).

Output: Updated App.css with flexbox fix, verified resize handles work, proportions matching SEdit layout
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-panel-layout-fix/11-RESEARCH.md
@src/App.tsx
@src/App.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add flexbox min-height fix to App.css</name>
  <files>src/App.css</files>
  <action>
Add CSS rules to override flexbox's automatic minimum size behavior on react-resizable-panels elements. This is the root cause of panels not shrinking properly, causing the canvas to collapse.

Add these rules to App.css (after the existing panel selector block around line 333):

```css
/* Fix flexbox automatic minimum size - allows panels to shrink properly */
/* Source: Flexbug #1 variant - https://github.com/philipwalton/flexbugs */
[data-panel-id] {
  min-height: 0;
  min-width: 0;
}

[data-panel-group-id] {
  min-height: 0;
  min-width: 0;
}
```

DO NOT remove the existing transition: none rule on these selectors - it's still needed for instant collapse/expand behavior.

Verify the existing resize handle CSS has correct cursor properties and no pointer-events: none that would block dragging. The current App.css should have cursor: col-resize and cursor: row-resize on the handles.
  </action>
  <verify>
Run `npm run typecheck` to ensure no TypeScript errors. Search App.css for the new rules to confirm they exist.
  </verify>
  <done>
App.css contains [data-panel-id] and [data-panel-group-id] rules with min-height: 0 and min-width: 0.
  </done>
</task>

<task type="auto">
  <name>Task 2: Adjust panel proportions for canvas dominance</name>
  <files>src/App.tsx</files>
  <action>
Review current defaultSize values and adjust if needed to ensure canvas dominance:

Current values (from App.tsx):
- Animation panel: defaultSize={18} (18% of horizontal space)
- Main area: defaultSize={82} (82% of horizontal space)
- Canvas: defaultSize={75} (75% of main area's vertical space)
- Tileset: defaultSize={25} (25% of main area's vertical space)

Math: Canvas = 82% * 75% = 61.5% of app-content area. This meets the >60% dominance requirement.

The proportions are already correct. DO NOT change them unless the visual test (Task 3) reveals issues.

If the visual test shows canvas is still too small after the CSS fix:
- Increase canvas defaultSize to 80 (82% * 80% = 65.6%)
- Decrease tileset defaultSize to 20
- Keep minSize values (canvas minSize={40}, tileset minSize={10})
  </action>
  <verify>
Run `npm run typecheck` to ensure no TypeScript errors after any changes.
  </verify>
  <done>
App.tsx has correct defaultSize proportions that result in canvas >60% of viewport.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>CSS flexbox fix for panel layout and verified proportions</what-built>
  <how-to-verify>
1. Run `npm run electron:dev` to start the app
2. Observe initial layout on launch:
   - Map canvas should fill the majority of the window (>60%)
   - Animation panel on left should be narrow (~18% width)
   - Tileset panel at bottom should show multiple tile rows
3. Test resize handles:
   - Hover the vertical divider between animation panel and main area
   - Cursor should change to col-resize (horizontal arrows)
   - Drag left/right - panels should resize smoothly
   - Hover the horizontal divider between canvas and tileset
   - Cursor should change to row-resize (vertical arrows)
   - Drag up/down - panels should resize smoothly
4. Test minimum sizes:
   - Drag canvas divider down toward tileset - should stop at minSize
   - Drag animation panel toward center - should stop at maxSize (30%)
5. Verify canvas is not collapsed to thin strip
  </how-to-verify>
  <resume-signal>Type "approved" if layout works correctly, or describe specific issues (e.g., "divider not draggable", "canvas still thin strip")</resume-signal>
</task>

</tasks>

<verification>
Phase 11 complete when:
1. App.css contains flexbox min-height fix
2. Panel dividers are draggable with correct cursors
3. Canvas visually dominates window (>60%)
4. Tileset shows multiple rows at 1080p
5. Animation panel previews visible (not cut off)
6. User has visually verified layout matches SEdit proportions
</verification>

<success_criteria>
- LAYOUT-01: Map canvas fills majority of window (not thin strip)
- LAYOUT-02: Tileset panel adequate height (multiple rows visible)
- LAYOUT-03: Animation panel adequate width (previews not cut off)
- LAYOUT-04: Panel dividers draggable (cursor changes, resize works)
- LAYOUT-05: Default sizes match SEdit proportions on fresh launch
</success_criteria>

<output>
After completion, create `.planning/phases/11-panel-layout-fix/11-01-SUMMARY.md`
</output>
