---
phase: 03-tabbed-bottom-panel
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/TabbedBottomPanel/TabbedBottomPanel.tsx
  - src/components/TabbedBottomPanel/TabbedBottomPanel.css
  - src/components/TabbedBottomPanel/index.ts
  - src/components/index.ts
  - src/App.tsx
  - src/components/ToolBar/ToolBar.tsx
autonomous: true

must_haves:
  truths:
    - "User sees tab bar at top of bottom panel with Tiles, Animations, Settings tabs"
    - "Clicking each tab displays corresponding content"
    - "Active tab has blue underline visual indicator"
    - "Arrow keys navigate between tabs and auto-switch content"
    - "Scroll position in each panel is preserved when switching tabs"
  artifacts:
    - path: "src/components/TabbedBottomPanel/TabbedBottomPanel.tsx"
      provides: "Tabbed container with ARIA-compliant keyboard navigation"
      exports: ["TabbedBottomPanel"]
    - path: "src/components/TabbedBottomPanel/TabbedBottomPanel.css"
      provides: "Tab bar styling with underline active indicator"
      contains: ".tab-bar"
    - path: "src/App.tsx"
      provides: "Integration of TabbedBottomPanel replacing conditional panels"
      contains: "<TabbedBottomPanel"
  key_links:
    - from: "src/App.tsx"
      to: "src/components/TabbedBottomPanel/TabbedBottomPanel.tsx"
      via: "import and render"
      pattern: "import.*TabbedBottomPanel"
    - from: "src/components/TabbedBottomPanel/TabbedBottomPanel.tsx"
      to: "TilePalette, AnimationPanel, MapSettingsPanel"
      via: "renders as tab content"
      pattern: "<TilePalette|<AnimationPanel|<MapSettingsPanel"
---

<objective>
Create a tabbed bottom panel component that organizes tile palette, animations, and settings into accessible tabs following VS Code/Chrome conventions.

Purpose: Replace the current toggle-based panel visibility with a proper tabbed interface that provides cleaner navigation and preserves scroll position when switching between panels.

Output: TabbedBottomPanel component integrated into App.tsx, with Tiles tab active by default.
</objective>

<execution_context>
@.claude/agents/gsd-executor.md
@.claude/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-tabbed-bottom-panel/03-CONTEXT.md
@.planning/phases/03-tabbed-bottom-panel/03-RESEARCH.md
@.planning/phases/02-layout-and-toolbar/02-02-SUMMARY.md
@src/App.tsx
@src/App.css
@src/components/ToolBar/ToolBar.tsx
@src/components/TilePalette/TilePalette.tsx
@src/components/AnimationPanel/AnimationPanel.tsx
@src/components/MapSettingsPanel/MapSettingsPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TabbedBottomPanel component</name>
  <files>
    src/components/TabbedBottomPanel/TabbedBottomPanel.tsx
    src/components/TabbedBottomPanel/TabbedBottomPanel.css
    src/components/TabbedBottomPanel/index.ts
    src/components/index.ts
  </files>
  <action>
Create a new TabbedBottomPanel component with ARIA-compliant tabs.

**TabbedBottomPanel.tsx structure:**
- useState for activeTab (default: 'tiles')
- useRef for tab button refs (for focus management)
- Tab configuration array: Tiles, Animations, Settings (in that order per user decision)
- Icons: Use Unicode emoji consistent with toolbar pattern (suggest: grid/palette icon for Tiles, play icon for Animations, gear for Settings)
- handleKeyDown: ArrowLeft/ArrowRight with wrap-around, automatic activation (switch tab AND focus)
- Render tab bar with role="tablist", aria-orientation="horizontal"
- Each tab button: role="tab", aria-selected, aria-controls, id, tabIndex (0 for active, -1 for inactive)
- Tab panels: role="tabpanel", hidden attribute for inactive (NOT conditional rendering - keeps them mounted), aria-labelledby
- Pass tilesetImage prop through to TilePalette and AnimationPanel

**Props interface:**
```typescript
interface TabbedBottomPanelProps {
  tilesetImage: HTMLImageElement | null;
}
```

**TabbedBottomPanel.css styling (per user decisions):**
- .tabbed-bottom-panel: flex column, full height
- .tab-bar: flex row, justify-content center, bg var(--bg-secondary), border-bottom
- .tab: min-width 120px, height 32px, flex center, gap 6px, border-bottom 2px solid transparent, no background, cursor pointer
- .tab:hover:not(.active): background rgba(255,255,255,0.05)
- .tab.active: border-bottom-color #3B82F6, color var(--text-primary)
- NO transition on border-bottom-color (instant switch per user decision)
- .tab-icon: font-size matching toolbar (18px)
- .tab-label: font-size 11px, text-transform none (unlike toolbar which is uppercase)
- .tab-content: flex 1, overflow hidden
- .tab-panel: width 100%, height 100%, overflow auto
- .tab-panel[hidden]: display none

**index.ts:** Export TabbedBottomPanel component

**Update src/components/index.ts:** Add TabbedBottomPanel export
  </action>
  <verify>
TypeScript compilation: `npm run typecheck` passes.
Component files exist at expected paths.
  </verify>
  <done>
TabbedBottomPanel component created with tab bar, keyboard navigation, and ARIA attributes. All three panel components (TilePalette, AnimationPanel, MapSettingsPanel) rendered as tab content with CSS hiding.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate TabbedBottomPanel into App.tsx</name>
  <files>
    src/App.tsx
  </files>
  <action>
Replace the current bottom panel content with TabbedBottomPanel.

**Changes to App.tsx:**

1. Remove state: `showSettings`, `showAnimations` (no longer needed - tabs handle this)

2. Remove imports: If TilePalette, AnimationPanel, MapSettingsPanel were imported directly, they can stay (TabbedBottomPanel imports them internally) OR remove if not used elsewhere

3. Add import: `TabbedBottomPanel` from @components

4. Replace bottom panel content:
```tsx
// Before:
<div className="bottom-panel">
  <TilePalette tilesetImage={tilesetImage} />
  {showAnimations && <AnimationPanel tilesetImage={tilesetImage} />}
  {showSettings && <MapSettingsPanel />}
</div>

// After:
<div className="bottom-panel">
  <TabbedBottomPanel tilesetImage={tilesetImage} />
</div>
```

5. Update ToolBar props: Remove showSettings, onToggleSettings, showAnimations, onToggleAnimations props - these are no longer used
  </action>
  <verify>
`npm run typecheck` passes.
App renders without errors.
  </verify>
  <done>
App.tsx uses TabbedBottomPanel component. Toggle state and props removed. Bottom panel shows tabbed interface.
  </done>
</task>

<task type="auto">
  <name>Task 3: Clean up ToolBar toggle buttons</name>
  <files>
    src/components/ToolBar/ToolBar.tsx
  </files>
  <action>
Remove the settings and animations toggle buttons from the toolbar since tabs now handle panel switching.

**Changes to ToolBar.tsx:**

1. Remove from props interface: showSettings, onToggleSettings, showAnimations, onToggleAnimations

2. Remove the settings toggle button (gear icon button that was conditionally styled)

3. Remove the animations toggle button (play icon button that was conditionally styled)

4. Keep all other toolbar buttons: New, Open, Save, tool buttons (Draw, Erase, Fill, Wall, Picker)

**Note:** The toolbar should still have tool selection buttons - only the panel toggle buttons are removed.
  </action>
  <verify>
`npm run typecheck` passes.
Toolbar renders with file and tool buttons, no panel toggle buttons.
Run app with `npm run electron:dev` and verify:
- Tab bar visible at top of bottom panel
- Three tabs: Tiles, Animations, Settings
- Clicking tabs switches content
- Arrow keys navigate tabs
- Active tab has blue underline
  </verify>
  <done>
Toolbar cleaned up. Panel toggle buttons removed. Tab interface is the sole method for switching between panels.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Visual verification:**
   - Tab bar visible at top of bottom panel with Tiles, Animations, Settings tabs
   - Tiles tab active by default (blue underline)
   - All tabs have icon + label, equal width, centered in panel

2. **Click interaction:**
   - Clicking each tab instantly shows corresponding content
   - No transition animation (per user decision)

3. **Keyboard navigation:**
   - Focus a tab, use ArrowLeft/ArrowRight
   - Tabs switch immediately (automatic activation)
   - Focus moves with selection
   - Wrap around from first to last and vice versa

4. **Scroll preservation:**
   - Scroll down in tile palette
   - Switch to Settings tab
   - Switch back to Tiles tab
   - Scroll position should be preserved

5. **Accessibility:**
   - Tab buttons have role="tab"
   - Tab panels have role="tabpanel"
   - aria-selected indicates active tab
   - Tab key moves into/out of tablist, arrow keys navigate within
</verification>

<success_criteria>
- [ ] TabbedBottomPanel component exists with proper ARIA attributes
- [ ] Tab bar shows Tiles, Animations, Settings tabs with icon + label
- [ ] Active tab has #3B82F6 blue underline indicator
- [ ] Clicking tabs switches content instantly (no animation)
- [ ] Arrow keys navigate tabs with automatic activation
- [ ] All three panels remain mounted (hidden via CSS, not unmounted)
- [ ] Scroll position preserved when switching away and back
- [ ] Toolbar no longer has settings/animations toggle buttons
- [ ] `npm run typecheck` passes
- [ ] App runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-tabbed-bottom-panel/03-01-SUMMARY.md`
</output>
