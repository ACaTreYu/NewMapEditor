---
phase: 43-integration-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/core/editor/slices/globalSlice.ts
  - src/core/editor/EditorState.ts
  - src/core/map/types.ts
  - src/core/map/SelectionTransforms.ts
  - src/core/editor/slices/documentsSlice.ts
  - src/components/MapCanvas/MapCanvas.tsx
  - src/components/ToolBar/ToolBar.tsx
  - public/assets/toolbar/eraser.svg
autonomous: true

must_haves:
  truths:
    - "Old clipboard transform functions (mirrorClipboardHorizontal, mirrorClipboardVertical, rotateClipboard) no longer exist anywhere in the codebase"
    - "Ctrl+H, Ctrl+J, Ctrl+R keyboard bindings no longer exist"
    - "Eraser tool (ToolType.ERASER) is completely removed from enum, toolbar, canvas, and icon file"
    - "180° and -180° rotation options are removed from toolbar, algorithm type signatures, and dispatcher"
    - "rotate180 function is removed from SelectionTransforms.ts"
    - "Application compiles without TypeScript errors after all removals"
  artifacts:
    - path: "src/core/editor/slices/globalSlice.ts"
      provides: "GlobalSlice without clipboard transform functions"
    - path: "src/core/editor/EditorState.ts"
      provides: "BackwardCompatLayer without mirrorHorizontal, mirrorVertical, rotateClipboard wrappers"
    - path: "src/core/map/types.ts"
      provides: "ToolType enum without ERASER"
    - path: "src/core/map/SelectionTransforms.ts"
      provides: "rotate() accepting only 90 | -90, without rotate180 function"
  key_links:
    - from: "src/components/ToolBar/ToolBar.tsx"
      to: "src/core/editor/EditorState.ts"
      via: "No references to mirrorHorizontal, mirrorVertical, rotateClipboard"
      pattern: "mirrorHorizontal|mirrorVertical|rotateClipboard should NOT appear"
---

<objective>
Remove all dead code from phases 41-42 replacement: old clipboard transform functions, eraser tool, 180° rotation options, and Ctrl+H/J/R keyboard bindings.

Purpose: Clean surgical deletion of superseded code. The new selection-based transforms (rotateSelectionForDocument, mirrorSelectionForDocument) have fully replaced the old clipboard-based transforms. This plan removes all vestiges.

Output: Clean codebase compiling without errors, with no dead clipboard transform code, no eraser tool, no 180° rotation.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/43-integration-cleanup/43-RESEARCH.md
@src/core/editor/slices/globalSlice.ts
@src/core/editor/EditorState.ts
@src/core/map/types.ts
@src/core/map/SelectionTransforms.ts
@src/core/editor/slices/documentsSlice.ts
@src/components/MapCanvas/MapCanvas.tsx
@src/components/ToolBar/ToolBar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove old clipboard transforms, eraser tool, and 180° rotation</name>
  <files>
    src/core/editor/slices/globalSlice.ts
    src/core/editor/EditorState.ts
    src/core/map/types.ts
    src/core/map/SelectionTransforms.ts
    src/core/editor/slices/documentsSlice.ts
    src/components/MapCanvas/MapCanvas.tsx
    src/components/ToolBar/ToolBar.tsx
    public/assets/toolbar/eraser.svg
  </files>
  <action>
    **Step 1: Remove old clipboard transform functions from globalSlice.ts**

    In `src/core/editor/slices/globalSlice.ts`:
    - Remove `mirrorClipboardHorizontal`, `mirrorClipboardVertical`, `rotateClipboard` from the `GlobalSlice` interface (lines 51-53)
    - Remove their implementations (lines 151-201: the three function bodies)
    - Keep `setClipboard` — it's still used for copy/paste operations

    **Step 2: Remove backward-compat wrappers from EditorState.ts**

    In `src/core/editor/EditorState.ts`:
    - Remove `mirrorHorizontal`, `mirrorVertical`, `rotateClipboard` from the `BackwardCompatLayer` interface (lines 56-58)
    - Remove their wrapper implementations (lines 410-420: the three function bodies that delegate to globalSlice)
    - Search entire file for any remaining references to these three function names — remove all

    **Step 3: Remove Ctrl+H/J/R keyboard bindings from ToolBar.tsx**

    In `src/components/ToolBar/ToolBar.tsx`:
    - Remove the three `case` blocks for `'h'`, `'j'`, `'r'` from the `if (e.ctrlKey || e.metaKey)` switch statement (lines 350-361)
    - Remove the imports/selectors for `mirrorHorizontal`, `mirrorVertical`, `rotateClipboard` (lines 123-125)
    - Remove these three from the useEffect dependency array (line 380)

    **Step 4: Remove Eraser tool completely**

    In `src/core/map/types.ts`:
    - Remove `ERASER = 'eraser'` from the ToolType enum (line 108)

    In `src/components/ToolBar/ToolBar.tsx`:
    - Remove the eraser entry from the `tools` array: `{ tool: ToolType.ERASER, label: 'Eraser', icon: 'eraser', shortcut: 'E' }` (line 30)

    In `src/components/MapCanvas/MapCanvas.tsx`:
    - At line 841 comment "Pencil/eraser - start drag operation": change to just "Pencil - start drag operation"
    - At line 957 comment "Commit undo for pencil/eraser drag operations": remove "/eraser"
    - At line 961: change `if (currentTool === ToolType.PENCIL || currentTool === ToolType.ERASER)` to `if (currentTool === ToolType.PENCIL)`
    - At line 978 comment "Commit pencil/eraser drag if active": remove "/eraser"
    - At line 979: change `if (currentTool === ToolType.PENCIL || currentTool === ToolType.ERASER)` to `if (currentTool === ToolType.PENCIL)`
    - At line 1061-1062: remove the `case ToolType.ERASER: eraseTile(x, y); break;` case

    Delete the file: `public/assets/toolbar/eraser.svg`

    **Step 5: Remove 180° and -180° rotation options**

    In `src/core/map/SelectionTransforms.ts`:
    - Delete the entire `rotate180` function (lines 96-128, including JSDoc comment)
    - Update the `rotate` dispatcher function signature: change `angle: 90 | -90 | 180 | -180` to `angle: 90 | -90`
    - Remove the `case 180:` and `case -180:` branches from the switch statement
    - Keep only `case 90:` and `case -90:`

    In `src/core/editor/slices/documentsSlice.ts`:
    - Update the `rotateSelectionForDocument` method signature (line 64): change `angle: 90 | -90 | 180 | -180` to `angle: 90 | -90`

    In `src/components/ToolBar/ToolBar.tsx`:
    - In the ROTATE variant config (lines 214-230): Remove the `{ label: '180°', value: 180 }` and `{ label: '-180°', value: -180 }` variants
    - Update the angle cast on line 228: change `as 90 | -90 | 180 | -180` to `as 90 | -90`

    **Step 6: Verify**

    Run `npm run typecheck` to confirm zero TypeScript errors.
    Run a codebase-wide search for: `mirrorClipboardHorizontal`, `mirrorClipboardVertical`, `rotateClipboard` (as function refs), `ToolType.ERASER`, `rotate180`, `case 180`, `case -180` — all should return zero results in source files.
  </action>
  <verify>
    Run `npm run typecheck` — must pass with zero errors.
    Run grep across src/ for `mirrorClipboardHorizontal`, `mirrorClipboardVertical`, `ERASER`, `rotate180` — all must return zero matches.
  </verify>
  <done>
    - Zero TypeScript errors
    - No references to mirrorClipboardHorizontal, mirrorClipboardVertical, or rotateClipboard in any source file
    - No references to ToolType.ERASER in any source file
    - No references to rotate180 in any source file
    - Ctrl+H/J/R no longer bound in keyboard handler
    - eraser.svg deleted
    - rotate() only accepts 90 | -90
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with zero errors
2. Grep for `mirrorClipboardHorizontal|mirrorClipboardVertical|rotateClipboard` in src/ → zero matches
3. Grep for `ERASER|eraser` in src/ → zero matches (except possibly CSS class names unrelated to tool)
4. Grep for `rotate180` in src/ → zero matches
5. Grep for `Ctrl\+H|Ctrl\+J|case 'h'|case 'j'` in ToolBar.tsx → zero matches in the keyboard handler
6. `public/assets/toolbar/eraser.svg` does not exist
</verification>

<success_criteria>
All dead code from phases 41-42 replacement is surgically removed. The codebase compiles cleanly. No commented-out remnants remain. Ready for Plan 02 toolbar UI restructuring.
</success_criteria>

<output>
After completion, create `.planning/phases/43-integration-cleanup/43-01-SUMMARY.md`
</output>
