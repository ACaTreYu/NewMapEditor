---
phase: 43-integration-cleanup
plan: 02
type: execute
wave: 2
depends_on: ["43-01"]
files_modified:
  - src/components/ToolBar/ToolBar.tsx
  - src/components/ToolBar/ToolBar.css
  - src/core/map/types.ts
  - public/assets/toolbar/rotate-cw.svg
  - public/assets/toolbar/rotate-ccw.svg
  - public/assets/toolbar/cut.svg
  - public/assets/toolbar/copy.svg
  - public/assets/toolbar/paste.svg
autonomous: true

must_haves:
  truths:
    - "Two separate Rotate CW and Rotate CCW buttons appear in toolbar (no dropdown)"
    - "Mirror button retains its 4-item dropdown (Right/Left/Up/Down)"
    - "Cut, Copy, Paste buttons appear in toolbar with icons"
    - "Toolbar order is: Select, Pencil, Fill, Picker | Rotate CW, Rotate CCW, Mirror | Cut, Copy, Paste | Line, Rect | Wall, W.Draw, W.Rect | Flag, Pole, Warp, Spawn, Switch | Bunker, H.Pen, Bridge, Conveyor | Grid, Settings"
    - "All single-letter tool shortcuts are removed (V, B, G, L, R, W, I, F, P, T, S, H, J, K, N, C, Q, A)"
    - "All Ctrl+ shortcuts still work: Ctrl+N, Ctrl+O, Ctrl+S, Ctrl+Z, Ctrl+Y, Ctrl+Shift+Z, Ctrl+C, Ctrl+X, Ctrl+V, Ctrl+D, Delete"
    - "Rotate CW, Rotate CCW, Mirror, Cut, Copy buttons are disabled (grayed) when no selection exists"
    - "Paste button is disabled when clipboard is empty"
  artifacts:
    - path: "src/components/ToolBar/ToolBar.tsx"
      provides: "Restructured toolbar with new button layout and disabled states"
    - path: "public/assets/toolbar/rotate-cw.svg"
      provides: "Clockwise rotation icon"
    - path: "public/assets/toolbar/rotate-ccw.svg"
      provides: "Counter-clockwise rotation icon"
    - path: "public/assets/toolbar/cut.svg"
      provides: "Cut (scissors) icon"
    - path: "public/assets/toolbar/copy.svg"
      provides: "Copy (two pages) icon"
    - path: "public/assets/toolbar/paste.svg"
      provides: "Paste (clipboard) icon"
  key_links:
    - from: "src/components/ToolBar/ToolBar.tsx"
      to: "src/core/editor/EditorState.ts"
      via: "hasSelection selector controls disabled state"
      pattern: "disabled=.*hasSelection"
    - from: "src/components/ToolBar/ToolBar.tsx"
      to: "rotateSelectionForDocument"
      via: "Rotate CW/CCW buttons call rotateSelectionForDocument with 90/-90"
      pattern: "rotateSelectionForDocument.*90"
---

<objective>
Restructure toolbar UI: split ROTATE dropdown into two separate CW/CCW action buttons, add Cut/Copy/Paste toolbar buttons, reorder all toolbar items per locked decision, remove all single-letter keyboard shortcuts, and add disabled states for transform/clipboard buttons.

Purpose: Complete the v2.5 milestone by delivering the final toolbar layout and interaction model. All tools accessible via toolbar buttons only (no single-letter shortcuts). Transform and clipboard operations have proper disabled states.

Output: Fully restructured toolbar with correct ordering, new icons, and disabled-state logic.
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/43-integration-cleanup/43-RESEARCH.md
@.planning/phases/43-integration-cleanup/43-01-SUMMARY.md
@src/components/ToolBar/ToolBar.tsx
@src/components/ToolBar/ToolBar.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create toolbar icons for rotate CW/CCW and clipboard buttons</name>
  <files>
    public/assets/toolbar/rotate-cw.svg
    public/assets/toolbar/rotate-ccw.svg
    public/assets/toolbar/cut.svg
    public/assets/toolbar/copy.svg
    public/assets/toolbar/paste.svg
  </files>
  <action>
    Create 5 new SVG icon files in `public/assets/toolbar/`. All icons must follow existing conventions: 16x16 viewBox, `currentColor` for strokes/fills, simple monochrome geometric shapes.

    **rotate-cw.svg** — Clockwise circular arrow:
    - A curved arc path (roughly 270° of a circle, radius ~5, centered at 8,8)
    - An arrowhead pointing clockwise at the end of the arc
    - Use `stroke="currentColor"` with `fill="none"` for the arc, `fill="currentColor"` for the arrowhead
    - The arrow should visually indicate clockwise direction

    **rotate-ccw.svg** — Counter-clockwise circular arrow:
    - Mirror of rotate-cw.svg (horizontally flipped)
    - The arrow should visually indicate counter-clockwise direction

    **cut.svg** — Scissors:
    - Two overlapping ovals/circles at bottom (handles) with lines crossing above (blades)
    - Simple geometric interpretation, not detailed
    - Use `stroke="currentColor"` and `fill="none"`

    **copy.svg** — Two overlapping rectangles:
    - Two offset rectangles suggesting stacked pages
    - Back rectangle slightly offset up-left, front rectangle slightly offset down-right
    - Use `stroke="currentColor"` and `fill="none"` with `stroke-width="1.5"`

    **paste.svg** — Clipboard with page:
    - Rectangle with a small tab/clip at top
    - Simpler alternative: a rectangle with a smaller rectangle inside (page on clipboard)
    - Use `stroke="currentColor"` and `fill="none"` with `stroke-width="1.5"`

    All 5 files use `xmlns="http://www.w3.org/2000/svg"` and `viewBox="0 0 16 16"`.
  </action>
  <verify>
    All 5 SVG files exist in `public/assets/toolbar/`. Each is valid XML with 16x16 viewBox.
  </verify>
  <done>
    5 new icon files created: rotate-cw.svg, rotate-ccw.svg, cut.svg, copy.svg, paste.svg
  </done>
</task>

<task type="auto">
  <name>Task 2: Restructure toolbar with new buttons, ordering, disabled states, and remove single-letter shortcuts</name>
  <files>
    src/components/ToolBar/ToolBar.tsx
    src/core/map/types.ts
  </files>
  <action>
    This is the main restructuring task. All changes in ToolBar.tsx and types.ts.

    **Step 1: Remove ROTATE from ToolType enum (types.ts)**

    In `src/core/map/types.ts`, remove `ROTATE = 'rotate'` from the ToolType enum. The two new rotate buttons will be action buttons that don't correspond to a tool mode — they call `rotateSelectionForDocument` directly. Keep `MIRROR = 'mirror'` since it still uses a dropdown.

    Also delete the old `public/assets/toolbar/rotate.svg` file (replaced by rotate-cw.svg and rotate-ccw.svg).

    **Step 2: Restructure tool arrays (ToolBar.tsx)**

    Replace the existing tool arrays with new groupings. Remove ALL `shortcut` fields (set to `''`) since single-letter shortcuts are being removed.

    ```typescript
    // Core editing tools (non-game)
    const coreTools: ToolButton[] = [
      { tool: ToolType.SELECT, label: 'Select', icon: 'select', shortcut: '' },
      { tool: ToolType.PENCIL, label: 'Pencil', icon: 'pencil', shortcut: '' },
      { tool: ToolType.FILL, label: 'Fill', icon: 'fill', shortcut: '' },
      { tool: ToolType.PICKER, label: 'Picker', icon: 'picker', shortcut: '' },
    ];

    // Game drawing tools
    const gameDrawTools: ToolButton[] = [
      { tool: ToolType.LINE, label: 'Line', icon: 'line', shortcut: '' },
      { tool: ToolType.RECT, label: 'Rectangle', icon: 'rect', shortcut: '' },
    ];
    ```

    Keep `gameObjectStampTools`, `gameObjectRectTools`, `wallDrawTools` but set all shortcut values to `''`.

    Remove `transformActionTools` array entirely (rotate and mirror are handled differently now).

    Remove `allToolsWithShortcuts` since single-letter shortcuts are being removed.

    **Step 3: Remove ROTATE variant config, keep MIRROR**

    In the `variantConfigs` array:
    - Remove the entire ROTATE config object (the one with `tool: ToolType.ROTATE`)
    - Keep the MIRROR config but update the setter to cast angle as before
    - Update `variantToolsSet` and `actionToolsSet` — remove ROTATE references

    Since ROTATE is no longer in the ToolType enum, remove it from `actionToolsSet`. MIRROR should remain an action tool with its dropdown.

    **Step 4: Add hasSelection and hasClipboard selectors**

    Add these Zustand selectors near the existing canUndo/canRedo selectors:

    ```typescript
    const hasSelection = useEditorStore((state) => {
      if (!state.activeDocumentId) return false;
      const doc = state.documents.get(state.activeDocumentId);
      return doc ? doc.selection.active && !doc.isPasting : false;
    });

    const hasClipboard = useEditorStore((state) => state.clipboard !== null);
    ```

    **Step 5: Add rotate CW/CCW action handlers**

    Add two handler functions:

    ```typescript
    const handleRotateCW = () => {
      const state = useEditorStore.getState();
      const activeDocId = state.activeDocumentId;
      if (!activeDocId) return;
      const doc = state.documents.get(activeDocId);
      if (!doc || !doc.selection.active || doc.isPasting) return;
      state.rotateSelectionForDocument(activeDocId, 90);
    };

    const handleRotateCCW = () => {
      const state = useEditorStore.getState();
      const activeDocId = state.activeDocumentId;
      if (!activeDocId) return;
      const doc = state.documents.get(activeDocId);
      if (!doc || !doc.selection.active || doc.isPasting) return;
      state.rotateSelectionForDocument(activeDocId, -90);
    };
    ```

    **Step 6: Remove single-letter shortcuts from keyboard handler**

    In the `useEffect` keyboard handler:
    - Keep the entire `if (e.ctrlKey || e.metaKey)` block (Ctrl+ shortcuts) — but WITHOUT the 'h', 'j', 'r' cases (already removed in Plan 01)
    - Keep the `if (e.key === 'Delete')` block
    - Remove the entire block that searches `allToolsWithShortcuts` and calls `setTool`:
      ```typescript
      // DELETE THIS:
      const tool = allToolsWithShortcuts.find((t) => t.shortcut.toLowerCase() === e.key.toLowerCase());
      if (tool) setTool(tool.tool);
      ```
    - Remove `mirrorHorizontal`, `mirrorVertical`, `rotateClipboard` from the useEffect dependency array if still present

    **Step 7: Restructure toolbar JSX rendering**

    Replace the entire toolbar button rendering section (inside `<div className="toolbar">`) with this order:

    ```
    New/Open/Save buttons (unchanged)
    separator
    Undo/Redo buttons (unchanged)
    separator
    Core tools: Select, Pencil, Fill, Picker (using coreTools.map(renderToolButton))
    separator
    Rotate CW button (direct action button, disabled={!hasSelection})
    Rotate CCW button (direct action button, disabled={!hasSelection})
    Mirror button (using renderToolButton for MIRROR, which has dropdown)
    separator
    Cut button (disabled={!hasSelection})
    Copy button (disabled={!hasSelection})
    Paste button (disabled={!hasClipboard})
    separator
    Game draw tools: Line, Rect (using gameDrawTools.map(renderToolButton))
    separator
    Wall tools: Wall, W.Draw, W.Rect (combine wall + wallDrawTools)
    separator
    Game stamp tools: Flag, Pole, Warp, Spawn, Switch
    separator
    Game rect tools: Bunker, H.Pen, Bridge, Conveyor
    separator
    Grid toggle button (unchanged)
    Settings button (unchanged)
    ```

    The Rotate CW/CCW buttons are rendered directly (not via renderToolButton) as simple action buttons:

    ```tsx
    <button
      className="toolbar-button"
      onClick={handleRotateCW}
      disabled={!hasSelection}
      title="Rotate 90° Clockwise"
    >
      <img src={`${iconBase}rotate-cw.svg`} alt="Rotate CW" className="toolbar-icon" />
    </button>
    <button
      className="toolbar-button"
      onClick={handleRotateCCW}
      disabled={!hasSelection}
      title="Rotate 90° Counter-Clockwise"
    >
      <img src={`${iconBase}rotate-ccw.svg`} alt="Rotate CCW" className="toolbar-icon" />
    </button>
    ```

    The Cut/Copy/Paste buttons are also direct renders:

    ```tsx
    <button
      className="toolbar-button"
      onClick={() => cutSelection()}
      disabled={!hasSelection}
      title="Cut (Ctrl+X)"
    >
      <img src={`${iconBase}cut.svg`} alt="Cut" className="toolbar-icon" />
    </button>
    <button
      className="toolbar-button"
      onClick={() => copySelection()}
      disabled={!hasSelection}
      title="Copy (Ctrl+C)"
    >
      <img src={`${iconBase}copy.svg`} alt="Copy" className="toolbar-icon" />
    </button>
    <button
      className="toolbar-button"
      onClick={() => startPasting()}
      disabled={!hasClipboard}
      title="Paste (Ctrl+V)"
    >
      <img src={`${iconBase}paste.svg`} alt="Paste" className="toolbar-icon" />
    </button>
    ```

    For the MIRROR button, it must still use `renderToolButton` since it has a variant dropdown. But the MIRROR button needs `disabled={!hasSelection}` too. Update `renderToolButton` to accept a disabled override, OR render the MIRROR button wrapper inline with the disabled prop. The simplest approach: add a special case in `renderToolButton` — if the tool is MIRROR, add `disabled={!hasSelection}` to the button element. Alternatively, render it inline similar to rotate buttons but with the dropdown.

    The Wall tool itself needs to be added to the wall section. Currently it's in the `tools` array. Move `{ tool: ToolType.WALL, label: 'Wall', icon: 'wall', shortcut: '' }` to a `wallTools` array that includes WALL, WALL_PENCIL, WALL_RECT.

    **Step 8: Clean up the handleToolClick and variant logic**

    Since ROTATE is removed from ToolType and variantConfigs:
    - `actionToolsSet` should now only contain MIRROR
    - `handleToolClick` still needs the action tool check for MIRROR dropdown behavior
    - Remove any remaining references to the old rotate dropdown

    **Step 9: Update the `renderToolButton` title format**

    Since shortcuts are removed, update the title from `${tool.label} (${tool.shortcut})` to just `tool.label` (remove the shortcut portion from the title attribute since all shortcuts are empty).

    **Step 10: Delete old rotate.svg**

    Delete `public/assets/toolbar/rotate.svg` (replaced by rotate-cw.svg and rotate-ccw.svg).

    **Step 11: Verify**

    Run `npm run typecheck` — must pass.
    Run `npm run electron:dev` to visually verify:
    - Toolbar shows correct button order
    - Rotate CW/CCW are separate single-click buttons
    - Mirror still has dropdown
    - Cut/Copy/Paste buttons present
    - All transform/clipboard buttons grayed when no selection
    - Single-letter keys no longer switch tools
    - All Ctrl+ shortcuts still work
  </action>
  <verify>
    Run `npm run typecheck` — must pass with zero errors.
    Grep for `allToolsWithShortcuts` in src/ — zero matches.
    Grep for `ToolType.ROTATE` in src/ — zero matches (ROTATE enum value removed).
    Grep for `shortcut: 'V'` or similar non-empty shortcuts in ToolBar.tsx — zero matches.
  </verify>
  <done>
    - Toolbar renders correct order: Select, Pencil, Fill, Picker | Rotate CW, Rotate CCW, Mirror | Cut, Copy, Paste | Line, Rect | Wall, W.Draw, W.Rect | Flag, Pole, Warp, Spawn, Switch | Bunker, H.Pen, Bridge, Conveyor | Grid, Settings
    - Rotate CW/CCW are direct action buttons (no dropdown), each with directional arrow icon
    - Mirror retains 4-item dropdown (Right/Left/Up/Down)
    - Cut, Copy, Paste buttons with appropriate icons
    - hasSelection disables Rotate CW, Rotate CCW, Mirror, Cut, Copy when no selection
    - hasClipboard disables Paste when clipboard empty
    - No single-letter tool shortcuts remain
    - All Ctrl+ shortcuts preserved
    - Zero TypeScript errors
    - Old rotate.svg deleted
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes
2. Toolbar visual order matches locked decision exactly
3. Rotate buttons are separate CW/CCW (no dropdown)
4. Mirror has 4-item dropdown
5. Cut/Copy/Paste buttons present with icons
6. Transform buttons disabled (grayed) when no selection
7. Paste disabled when no clipboard data
8. No single-letter keyboard shortcuts work
9. Ctrl+N/O/S/Z/Y/C/X/V/D and Delete all still work
10. Old rotate.svg deleted, 5 new SVGs created
</verification>

<success_criteria>
The toolbar is fully restructured per all locked decisions. All old shortcuts removed, new buttons added with correct ordering and disabled states. v2.5 milestone deliverable complete.
</success_criteria>

<output>
After completion, create `.planning/phases/43-integration-cleanup/43-02-SUMMARY.md`
</output>
