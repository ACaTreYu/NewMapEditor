---
phase: 95-tileset-rendered-icons
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ToolBar/ToolBar.tsx
autonomous: false

must_haves:
  truths:
    - "Flag toolbar button displays a tile image from the loaded tileset (tile 905 = green flag pad)"
    - "Switch toolbar button displays a tile image from the loaded tileset (tile 743 = switch unflipped)"
    - "Conveyor toolbar button displays a tile image from the loaded tileset (tile 1717 = conveyor right TL)"
    - "Spawn toolbar button still displays tileset tile 1223 (unchanged from v3.6)"
    - "Pole toolbar button still displays tileset tile 1361 (unchanged from v3.6)"
    - "Warp toolbar button still displays first frame of anim 0x9E (unchanged from v3.6)"
    - "When no tileset is loaded, all eight game object tools fall back to SVG icons without errors"
    - "Loading a different GFX patch updates all six tileset-rendered icons to reflect the new tileset"
  artifacts:
    - path: "src/components/ToolBar/ToolBar.tsx"
      provides: "Tileset-rendered icons for all six game object tools, SVG fallbacks for all eight"
      contains: "['flag', 905]"
  key_links:
    - from: "tilesetToolIcons useMemo"
      to: "renderToolButton tilesetIcon check"
      via: "tilesetToolIcons[tool.icon] lookup returns dataURL string"
      pattern: "tilesetToolIcons\\[tool\\.icon\\]"
---

<objective>
Convert flag, switch, and conveyor toolbar icons from dead PNG imports to tileset-rendered canvas snippets, matching the existing pattern used by spawn, pole, and warp. Add SVG fallbacks for bunker and turret (which also had dead PNG imports).

Purpose: All six tileset-renderable game object tool buttons should display the actual tile artwork from the loaded tileset. Bunker and turret get SVG fallbacks so they display meaningful icons instead of plain text after their dead PNG imports are removed.

Output: Updated ToolBar.tsx where the `tilesetToolIcons` useMemo renders all six game object tools from the tileset, with clean SVG fallbacks when no tileset is loaded. Bunker and turret show SVG icons (they will get tileset-rendered treatment in Phase 97).
</objective>

<execution_context>
@C:\Users\arcje\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\arcje\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/ToolBar/ToolBar.tsx
@.planning/phases/95-tileset-rendered-icons/95-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove dead PNG imports, add tileset-rendered flag/switch/conveyor, add SVG fallbacks for bunker/turret/conveyor</name>
  <files>src/components/ToolBar/ToolBar.tsx</files>
  <action>
Modify ToolBar.tsx with these changes:

1. **Remove ALL 5 dead PNG import lines** at the top of the file (lines 25-29). None of these PNG files exist on disk — `bunkericon.png`, `conveyoricon.png`, `flagicon.png`, `switchicon.png`, and `turreticon.png` are all missing from `assets/toolbar/`. Only `bunker-sedit.png` exists there, but nothing imports it. Remove all five lines:
   ```
   import bunkerIcon from '@/assets/toolbar/bunkericon.png';    // DELETE — file does not exist
   import conveyorIcon from '@/assets/toolbar/conveyoricon.png'; // DELETE — file does not exist
   import flagIcon from '@/assets/toolbar/flagicon.png';         // DELETE — file does not exist
   import switchIcon from '@/assets/toolbar/switchicon.png';     // DELETE — file does not exist
   import turretIcon from '@/assets/toolbar/turreticon.png';     // DELETE — file does not exist
   ```

2. **Add SVG fallback icons for bunker, turret, and conveyor** to the `toolIcons` map (around line 33). These three tools currently have NO entry in `toolIcons`, so when no tileset is loaded they would show plain text labels. Fix this:
   - Add `LuTarget` to the existing destructured `react-icons/lu` import (for turret)
   - Add `LuArrowRight` to the existing destructured `react-icons/lu` import (for conveyor)
   - `GiStoneBridge` is already imported — use it for bunker
   - Add these entries to the `toolIcons` map:
     ```typescript
     bunker: GiStoneBridge,
     turret: LuTarget,
     conveyor: LuArrowRight,
     ```
   Note: `flag`, `switch`, `spawn`, `pole`, `warp` already have SVG fallback entries in `toolIcons` — leave them unchanged.

3. **Replace the pre-populated icons object** in the `tilesetToolIcons` useMemo (lines 296-302) with an empty object:
   ```typescript
   const icons: Record<string, string> = {};
   if (!tilesetImage) return icons;
   ```
   Previously this object was initialized with `bunker: bunkerIcon, conveyor: conveyorIcon, flag: flagIcon, switch: switchIcon, turret: turretIcon` — all referencing dead imports. Now it starts empty. When no tileset is loaded, the empty object means all tools fall through to their SVG fallback in `toolIcons`.

4. **Update the comment** above the useMemo (line 294) from:
   ```
   // Toolbar icons: static assets for bunker/conveyor/flag/switch, tileset-rendered for spawn/pole/warp
   ```
   To:
   ```
   // Toolbar icons: tileset-rendered for spawn/pole/warp/flag/switch/conveyor (SVG fallback when no tileset)
   ```

5. **Add flag, switch, conveyor to the `singles` array** (currently line 314):
   Change from:
   ```typescript
   const singles: [string, number][] = [['spawn', 1223], ['pole', 1361]];
   ```
   To:
   ```typescript
   const singles: [string, number][] = [
     ['spawn', 1223],    // anim 0xA6 Yellow OnMapSpawn
     ['pole', 1361],     // anim 0x6A Neutral Cap Pad MM
     ['flag', 905],      // anim 0x1C Green Pad GreenFlag Sec, frame 0
     ['switch', 743],    // anim 0x7B Switch Unflipped, frame 0
     ['conveyor', 1717], // anim 0xB7 Conveyor right TL, frame 0
   ];
   ```
   The warp entry via `ANIMATION_DEFINITIONS[0x9E]` remains unchanged after the singles array.
  </action>
  <verify>
  1. Run `npm run typecheck` — no TypeScript errors (confirms dead imports are cleanly removed, new icon imports resolve)
  2. Run `npm run electron:dev` — app launches, toolbar renders without console errors
  3. Open a map file (which loads the tileset): flag, switch, and conveyor buttons show tileset tiles instead of broken images
  4. Close all maps (no tileset loaded): flag shows LuFlag, switch shows LuToggleLeft, conveyor shows LuArrowRight, bunker shows GiStoneBridge, turret shows LuTarget
  5. Spawn, pole, warp icons still render correctly from tileset (regression check)
  </verify>
  <done>
  - All 5 dead PNG imports removed — no broken import references
  - Flag button: shows tile 905 (green flag pad) when tileset loaded, LuFlag SVG when not
  - Switch button: shows tile 743 (switch unflipped) when tileset loaded, LuToggleLeft SVG when not
  - Conveyor button: shows tile 1717 (conveyor right TL) when tileset loaded, LuArrowRight SVG when not
  - Bunker button: shows GiStoneBridge SVG fallback (no tileset rendering yet — Phase 97)
  - Turret button: shows LuTarget SVG fallback (no tileset rendering yet — Phase 97)
  - Spawn/pole/warp: unchanged, still tileset-rendered with existing SVG fallbacks
  - No TypeScript errors, no console errors, no broken img src
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of toolbar icons</name>
  <what-built>Flag, switch, and conveyor toolbar buttons now render tiles from the loaded tileset, joining spawn/pole/warp which were already tileset-rendered. All 5 dead PNG imports removed. Bunker and turret now show SVG fallback icons (previously had dead PNG imports that never rendered). When no tileset is loaded, all eight game object tools show SVG fallback icons.</what-built>
  <how-to-verify>
    1. Run `npm run electron:dev`
    2. Open the app — before loading any map, check toolbar:
       - Flag button: LuFlag SVG icon (pennant shape)
       - Switch button: LuToggleLeft SVG icon
       - Conveyor button: LuArrowRight SVG icon (right arrow)
       - Spawn: LuCrosshair SVG icon
       - Pole: LuFlagTriangleRight SVG icon
       - Warp: LuCircleDot SVG icon
       - Bunker: GiStoneBridge SVG icon (bridge shape)
       - Turret: LuTarget SVG icon (target shape)
    3. Open a map file (File > Open or Ctrl+O)
    4. After tileset loads, check toolbar:
       - Flag button: green flag pad tile (tile 905)
       - Switch button: switch tile (tile 743)
       - Conveyor button: conveyor arrow tile (tile 1717)
       - Spawn: yellow spawn tile (tile 1223)
       - Pole: neutral cap pad tile (tile 1361)
       - Warp: big warp tile (first frame of anim 0x9E)
       - Bunker: SVG icon (unchanged — no tileset rendering yet)
       - Turret: SVG icon (unchanged — no tileset rendering yet)
    5. All six tileset-rendered icons should be 16x16 pixel art, crisp (not blurry)
    6. Load a different GFX patch (File > Load GFX Patch) — all six tileset-rendered icons update
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles cleanly: `npm run typecheck` passes with no errors
2. No console errors on startup (no broken img src, no missing module warnings)
3. All six tileset-renderable game object tools (flag, pole, warp, spawn, switch, conveyor) display tileset tiles when a tileset is loaded
4. Switching GFX patches updates all six tileset-rendered icons
5. When no tileset loaded, SVG fallback icons appear for all eight game object tools (including bunker and turret)
6. Bunker shows GiStoneBridge SVG; turret shows LuTarget SVG (both will get tileset treatment in Phase 97)
7. Icon dimensions are 16x16 with pixelated rendering (no blurring)
</verification>

<success_criteria>
- ICON-01: Flag tool icon rendered from tileset tile 905 (green flag pad)
- ICON-02: Pole tool icon rendered from tileset tile 1361 (neutral cap pad) [already done in v3.6, confirmed working]
- ICON-03: Warp tool icon rendered from tileset anim 0x9E frame 0 [already done in v3.6, confirmed working]
- ICON-04: Spawn tool icon rendered from tileset tile 1223 [already done in v3.6, confirmed working]
- ICON-05: Switch tool icon rendered from tileset tile 743 (switch unflipped)
- ICON-06: Conveyor tool icon rendered from tileset tile 1717 (conveyor right TL)
- SVG fallback for all eight game object tools when no tileset loaded (including bunker=GiStoneBridge, turret=LuTarget)
- No JavaScript errors when tileset is not loaded (graceful SVG fallback)
- Loading a different GFX patch updates all tileset-rendered icons
</success_criteria>

<output>
After completion, create `.planning/phases/95-tileset-rendered-icons/95-01-SUMMARY.md`
</output>
