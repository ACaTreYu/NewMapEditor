# Milestone v2.1: MDI Editor & Polish

**Status:** SHIPPED 2026-02-09
**Phases:** 33-36
**Total Plans:** 6

## Overview

Multiple maps open as child windows with per-document undo/redo, cross-document clipboard, status bar tile hover, and scrollable settings dialog. Completed the transition from single-document to full MDI editor.

## Phases

### Phase 33: Document State Refactoring

**Goal**: Per-document state isolation with independent undo/redo
**Depends on**: Phase 32
**Requirements**: DOC-01, DOC-02, DOC-03, DOC-04
**Plans**: 2 plans

Plans:
- [x] 33-01: Core document state architecture (types, slices, EditorState refactoring)
- [x] 33-02: Component migration and document lifecycle

**Details:**
- Introduced GlobalSlice/DocumentsSlice architecture with backward-compat wrappers
- Documents stored in Map<DocumentId, DocumentState> for O(1) access
- Undo stack limit increased to 100 entries per document
- Top-level state fields sync from active document for backward compatibility
- File > New/Open always creates documents alongside existing ones

### Phase 34: MDI Window Management

**Goal**: Multiple map child windows with drag/resize, arrangement commands, and focus management
**Depends on**: Phase 33
**Requirements**: MDI-01, MDI-02, MDI-03, MDI-04, MDI-05
**Plans**: 2 plans

Plans:
- [x] 34-01: Window state slice, arrangement algorithms, document limit enforcement
- [x] 34-02: Workspace/ChildWindow components, App.tsx rework, Window menu integration

**Details:**
- MAX_OPEN_DOCUMENTS = 8 (prevents canvas context exhaustion)
- Custom MDI with react-rnd (not FlexLayout â€” simpler, fewer conflicts)
- Cascade offset 40px, z-index normalization at 100k threshold
- dragHandleClassName restricts drag to title bar only (prevents MapCanvas conflicts)
- Per-document MapCanvas rendering via documentId prop
- Toolbar dropdown z-index raised to 200k (above MDI window z-indexes)
- Yes/No/Cancel close dialog for unsaved changes

### Phase 35: Cross-Document Operations

**Goal**: Clipboard and picker work across map documents
**Depends on**: Phase 34
**Requirements**: XDOC-01, XDOC-02
**Plans**: 1 plan

Plans:
- [x] 35-01: Move clipboard to global state for cross-document copy/paste

**Details:**
- Clipboard state moved from per-document to GlobalSlice
- isPasting and pastePreviewPosition remain per-document for independent paste previews
- Clipboard transformations (mirror/rotate) operate on global state
- Full 16-bit tile encoding preserved across documents

### Phase 36: Status Bar & UI Polish

**Goal**: Status bar tile hover info and scrollable settings dialog
**Depends on**: Phase 35
**Requirements**: STAT-01, STAT-02, UI-01
**Plans**: 1 plan

Plans:
- [x] 36-01: Status bar hover info (map + tileset) and scrollable settings dialog

**Details:**
- Source-aware hover display: X/Y for map, Col/Row for tileset
- TilePalette onTileHover callback fires before drag check
- Flexbox-based responsive scroll for settings dialog tabs (no fixed pixel heights)

---

## Milestone Summary

**Key Decisions:**
- Documents stored in Map<DocumentId, DocumentState> for O(1) access
- MAX_OPEN_DOCUMENTS = 8 to prevent canvas context exhaustion
- Custom MDI with react-rnd instead of FlexLayout
- Clipboard in GlobalSlice for cross-document operations
- Per-document paste preview isolation (prevents leak across windows)
- dragHandleClassName restricts drag to title bar only

**Issues Resolved:**
- Infinite re-render loop in Workspace (memoized arrangement arrays)
- MapCanvas only rendering active document data (per-document documentId prop)
- Toolbar dropdowns hidden behind MDI windows (z-index 200k)
- White screen on mount (fixed component initialization order)
- Undo/redo map rendering and wall batch auto-connection (post-phase-33 fix)

**Issues Deferred:**
- Content-aware transforms not implemented (directional tiles may rotate incorrectly)
- Minimap placeholder when no map loaded (todo)

**Technical Debt Incurred:**
- Title bar gradient still uses hardcoded hex colors (intentional for linear-gradient)
- Phase 20 completed outside GSD tracking (no SUMMARY.md)
- Three stale empty phase directories (16-marquee-selection, 18-tool-investigation-fixes, 20-animation-panel-redesign)

---

_For current project status, see .planning/ROADMAP.md_
